<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="[ClbkKartyDelete]"></A><PRE>
          <FONT SIZE="2"><I>/* [ClbkKartyDelete] */</I><BR>
CREATE PROCEDURE [cdn].[ClbkKartyDelete]
(
	@Original_Clbk_Id int,
	@Original_Clbk_SumaKontrolna binary(16),
	@Original_Clbk_Autor varchar(50),
	@Original_Clbk_Dodany datetime,
	@Original_Clbk_Nazwa varchar(100),
	@Original_Clbk_OpeNumer int,
	@Original_Clbk_Opis varchar(500),
	@Original_Clbk_Stan smallint,
	@Original_Clbk_Utworzony datetime,
	@Original_Clbk_Wersja varchar(10),
	@Original_Clbk_WersjaXL varchar(10),
	@Original_Clbk_Zmodyfikowany timestamp
)
AS
	SET NOCOUNT OFF;
DELETE FROM CDN.ClbkKarty WHERE (Clbk_Id = @Original_Clbk_Id) AND (Clbk_SumaKontrolna = @Original_Clbk_SumaKontrolna) AND (Clbk_Autor = @Original_Clbk_Autor OR @Original_Clbk_Autor IS NULL AND Clbk_Autor IS NULL) AND (Clbk_Dodany = @Original_Clbk_Dodany) AND (Clbk_Nazwa = @Original_Clbk_Nazwa) AND (Clbk_OpeNumer = @Original_Clbk_OpeNumer) AND (Clbk_Opis = @Original_Clbk_Opis OR @Original_Clbk_Opis IS NULL AND Clbk_Opis IS NULL) AND (Clbk_Stan = @Original_Clbk_Stan) AND (Clbk_Utworzony = @Original_Clbk_Utworzony) AND (Clbk_Wersja = @Original_Clbk_Wersja) AND (Clbk_WersjaXL = @Original_Clbk_WersjaXL) AND (Clbk_Zmodyfikowany = @Original_Clbk_Zmodyfikowany);
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
<DIV CLASS="TextInfo">
      <P><A name="[ClbkKartyInsert]"></A><PRE>
          <FONT SIZE="2"><I>/* [ClbkKartyInsert] */</I><BR>
CREATE PROCEDURE [cdn].[ClbkKartyInsert]
(
	@Clbk_Nazwa varchar(100),
	@Clbk_Opis varchar(500),
	@Clbk_Autor varchar(50),
	@Clbk_Utworzony datetime,
	@Clbk_Dodany datetime,
	@Clbk_Wersja varchar(10),
	@Clbk_WersjaXL varchar(10),
	@Clbk_Stan smallint,
	@Clbk_Assembly image,
	@Clbk_AssemblyPdb image,
	@Clbk_OpeNumer int,
	@Clbk_SumaKontrolna binary(16),
	@Clbk_Priorytet int
)
AS
	SET NOCOUNT OFF;
        INSERT INTO CDN.ClbkKarty(Clbk_Nazwa, Clbk_Opis, Clbk_Autor, Clbk_Utworzony, Clbk_Dodany, Clbk_Wersja, Clbk_WersjaXL, Clbk_Stan, Clbk_Assembly, Clbk_AssemblyPdb, Clbk_OpeNumer, Clbk_SumaKontrolna, Clbk_Priorytet) VALUES (@Clbk_Nazwa, @Clbk_Opis, @Clbk_Autor, @Clbk_Utworzony, @Clbk_Dodany, @Clbk_Wersja, @Clbk_WersjaXL, @Clbk_Stan, @Clbk_Assembly, @Clbk_AssemblyPdb, @Clbk_OpeNumer, @Clbk_SumaKontrolna, 0);
        SELECT Clbk_Id, Clbk_Nazwa, Clbk_Opis, Clbk_Autor, Clbk_Utworzony, Clbk_Dodany, Clbk_Zmodyfikowany, Clbk_Wersja, Clbk_WersjaXL, Clbk_Stan, Clbk_Assembly, Clbk_AssemblyPdb, Clbk_OpeNumer, Clbk_SumaKontrolna, Clbk_Priorytet FROM CDN.ClbkKarty WHERE (Clbk_Id = @@IDENTITY);
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
<DIV CLASS="TextInfo">
      <P><A name="[ClbkKartyUpdate]"></A><PRE>
          <FONT SIZE="2"><I>/* [ClbkKartyUpdate] */</I><BR>
create PROCEDURE [cdn].[ClbkKartyUpdate]
(
	@Clbk_Nazwa varchar(100),
	@Clbk_Opis varchar(500),
	@Clbk_Autor varchar(50),
	@Clbk_Utworzony datetime,
	@Clbk_Dodany datetime,
	@Clbk_Wersja varchar(10),
	@Clbk_WersjaXL varchar(10),
	@Clbk_Stan smallint,
	@Clbk_Assembly image,
	@Clbk_AssemblyPdb image,
	@Clbk_OpeNumer int,
	@Clbk_SumaKontrolna binary(16),
	@Original_Clbk_Id int,
	@Original_Clbk_SumaKontrolna binary(16),
	@Original_Clbk_Autor varchar(50),
	@Original_Clbk_Dodany datetime,
	@Original_Clbk_Nazwa varchar(100),
	@Original_Clbk_OpeNumer int,
	@Original_Clbk_Opis varchar(500),
	@Original_Clbk_Stan smallint,
	@Original_Clbk_Utworzony datetime,
	@Original_Clbk_Wersja varchar(10),
	@Original_Clbk_WersjaXL varchar(10),
	@Original_Clbk_Zmodyfikowany timestamp,
	@Clbk_Id int
)
AS
  SET NOCOUNT OFF;
  UPDATE CDN.ClbkKarty SET Clbk_Nazwa = @Clbk_Nazwa, Clbk_Opis = @Clbk_Opis, Clbk_Autor = @Clbk_Autor, Clbk_Utworzony = @Clbk_Utworzony, Clbk_Dodany = @Clbk_Dodany, Clbk_Wersja = @Clbk_Wersja, Clbk_WersjaXL = @Clbk_WersjaXL, 
     Clbk_Stan = @Clbk_Stan, Clbk_Assembly = @Clbk_Assembly, Clbk_AssemblyPdb = @Clbk_AssemblyPdb, Clbk_OpeNumer = @Clbk_OpeNumer, Clbk_SumaKontrolna = @Clbk_SumaKontrolna WHERE (Clbk_Id = @Original_Clbk_Id) AND 
     (Clbk_SumaKontrolna = @Original_Clbk_SumaKontrolna) AND (Clbk_Autor = @Original_Clbk_Autor OR @Original_Clbk_Autor IS NULL AND Clbk_Autor IS NULL) AND (Clbk_Dodany = @Original_Clbk_Dodany) AND 
     (Clbk_Nazwa = @Original_Clbk_Nazwa) AND (Clbk_OpeNumer = @Original_Clbk_OpeNumer) AND (Clbk_Opis = @Original_Clbk_Opis OR @Original_Clbk_Opis IS NULL AND Clbk_Opis IS NULL) AND (Clbk_Stan = @Original_Clbk_Stan) AND 
     (Clbk_Utworzony = @Original_Clbk_Utworzony) AND (Clbk_Wersja = @Original_Clbk_Wersja) AND (Clbk_WersjaXL = @Original_Clbk_WersjaXL) AND (Clbk_Zmodyfikowany = @Original_Clbk_Zmodyfikowany);
	
  SELECT Clbk_Id, Clbk_Nazwa, Clbk_Opis, Clbk_Autor, Clbk_Utworzony, Clbk_Dodany, Clbk_Zmodyfikowany, Clbk_Wersja, Clbk_WersjaXL, Clbk_Stan, Clbk_Assembly, Clbk_OpeNumer, Clbk_SumaKontrolna FROM CDN.ClbkKarty WHERE (Clbk_Id = @Clbk_Id);
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
<DIV CLASS="TextInfo">
      <P><A name="ClbkList"></A><PRE>
          <FONT SIZE="2"><I>/* ClbkList */</I><BR>
CREATE FUNCTION CDN.ClbkList(@OpeId int,@CenterId int)
RETURNS TABLE 
AS
RETURN SELECT Clbk_Id, Clbk_Nazwa, Clbk_Opis, Clbk_Autor,
Clbk_Utworzony, Clbk_Dodany, Clbk_Zmodyfikowany,
Clbk_Wersja, Clbk_WersjaXL, Clbk_Stan, Clbk_Assembly, Clbk_AssemblyPdb,
Clbk_OpeNumer, Clbk_SumaKontrolna,Clbk_Priorytet FROM CDN.ClbkKarty
WHERE (Clbk_Stan=0
AND EXISTS(SELECT * FROM CDN.ClbkFrs
JOIN CDN.FrmStruktura Centrum   
ON Centrum.Frs_Id=Clbf_FrsId AND
Centrum.Frs_GIDTyp=-4272 AND 
Centrum.Frs_GIDNumer=
(SELECT TOP 1 FrS.Frs_GIDNumer
FROM CDN.FrsCentra(1,-4272,@CenterID,0,0) AS Cent
INNER JOIN CDN.FrmStruktura AS FrS ON Cent.FrS_Id=FrS.Frs_Id
WHERE FrS.Frs_DodatkiZRodzica=0 OR FrS.Frs_Id=1
ORDER BY Cent.Frs_Poziom DESC) AND 
Clbf_ClbkId=CDN.ClbkKarty.Clbk_Id))
OR @OpeId=0
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
<DIV CLASS="TextInfo">
      <P><A name="ClbkProceduryInsert"></A><PRE>
          <FONT SIZE="2"><I>/* ClbkProceduryInsert */</I><BR>
CREATE PROCEDURE CDN.ClbkProceduryInsert
(@Clbp_ClbkId int,@Clbp_IdProcedury int,@Clbp_Opis varchar(500))
AS
SET NOCOUNT ON;
INSERT INTO CDN.ClbkProcedury (Clbp_ClbkID,Clbp_IdProcedury,Clbp_Opis) VALUES(@Clbp_ClbkId,@Clbp_IdProcedury,@Clbp_Opis)
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
<DIV CLASS="TextInfo">
      <P><A name="ClbkProceduryClear"></A><PRE>
          <FONT SIZE="2"><I>/* ClbkProceduryClear */</I><BR>
CREATE PROCEDURE CDN.ClbkProceduryClear(@Clbp_ClbkId int)
AS
SET NOCOUNT ON;
DELETE FROM CDN.ClbkProcedury WHERE Clbp_ClbkId=@Clbp_ClbkId
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>