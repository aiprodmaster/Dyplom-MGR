<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="KsiListaRejestrVAT_ZD"></A><PRE>
          <FONT SIZE="2"><I>/* KsiListaRejestrVAT_ZD */</I><BR>
CREATE PROCEDURE CDN.KsiListaRejestrVAT_ZD
@SesjaID int,
@Thread int
AS
BEGIN	
	/*
	SELECT		
		CAST(1 AS INT) TTV_VatNumer
		,CAST('FS-3/2022' AS VARCHAR) TTV_NumerDokumentu
		,CAST('AAAFS-3/2022' AS VARCHAR)TTV_DokumentObcy
		,CAST(90000 AS INT) TTV_TrnData2
		,CAST(90000 AS INT)TRP_Termin
		,CAST('AkronimKNT' AS VARCHAR) KnA_Akronim
		,CAST('NazwaKNT' AS VARCHAR) KnANazwa
		,CAST('NIPKnt' AS VARCHAR) KNA_NIP
		,CAST(23.00 AS DECIMAL(5,2)) TRV_StawkaPod
		,CAST(1 AS TINYINT) TRV_FlagaVat
		,CAST(100.00 AS DECIMAL(15,2)) TRV_Netto
		,CAST(23.00 AS DECIMAL(15,2)) TRV_Vat
		,CAST(123.00 AS DECIMAL(15,2)) TRVBrutto
		,CAST(123.00 AS DECIMAL(15,2)) TRVTRPPozostaje
		,CAST(100.00 AS DECIMAL(15,2)) ZD_Netto
		,CAST(23.00 AS DECIMAL(15,2)) ZD_Vat
		,CAST(123.00 AS DECIMAL(15,2)) ZD_Brutto
		,CAST(1521 AS SMALLINT) TRP_GIDTyp
		,CAST(1111 AS INT) TRP_GIDNumer
		,CAST(1 AS SMALLINT) TRP_GIDLp		
		,CAST(0 AS SMALLINT) DokumentZD
		,CAST(1111 AS INT) TTV_GIDNumer
		,CAST(90000 AS INT) PEDDataStanuRozliczen
	UNION ALL
	SELECT		
		CAST(1 AS INT) TTV_VatNumer
		,CAST('FS-3/2022' AS VARCHAR) TTV_NumerDokumentu
		,CAST('AAAFS-3/2022' AS VARCHAR)TTV_DokumentObcy
		,CAST(90000 AS INT) TTV_TrnData2
		,CAST(90000 AS INT)TRP_Termin
		,CAST('AkronimKNT' AS VARCHAR) KnA_Akronim
		,CAST('NazwaKNT' AS VARCHAR) KnANazwa
		,CAST('NIPKnt' AS VARCHAR) KNA_NIP
		,CAST(8.00 AS DECIMAL(5,2)) TRV_StawkaPod
		,CAST(1 AS TINYINT) TRV_FlagaVat
		,CAST(50.00 AS DECIMAL(15,2)) TRV_Netto
		,CAST(4.00 AS DECIMAL(15,2)) TRV_Vat
		,CAST(54.00 AS DECIMAL(15,2)) TRVBrutto
		,CAST(54.00 AS DECIMAL(15,2)) TRVTRPPozostaje
		,CAST(50.00 AS DECIMAL(15,2)) ZD_Netto
		,CAST(4.00 AS DECIMAL(15,2)) ZD_Vat
		,CAST(54.00 AS DECIMAL(15,2)) ZD_Brutto
		,CAST(1521 AS SMALLINT) TRP_GIDTyp
		,CAST(1111 AS INT) TRP_GIDNumer
		,CAST(1 AS SMALLINT) TRP_GIDLp		
		,CAST(0 AS SMALLINT) DokumentZD
		,CAST(1111 AS INT) TTV_GIDNumer
		,CAST(90000 AS INT) PEDDataStanuRozliczen
	UNION ALL
	SELECT		
		CAST(2 AS INT) TTV_VatNumer
		,CAST('ZD-6/2022' AS VARCHAR) TTV_NumerDokumentu
		,CAST('AAAZD-6/2022' AS VARCHAR)TTV_DokumentObcy
		,CAST(90000 AS INT) TTV_TrnData2
		,CAST(90000 AS INT)TRP_Termin
		,CAST('AkronimKNT' AS VARCHAR) KnA_Akronim
		,CAST('NazwaKNT' AS VARCHAR) KnANazwa
		,CAST('NIPKnt' AS VARCHAR) KNA_NIP
		,CAST(23.00 AS DECIMAL(5,2)) TRV_StawkaPod
		,CAST(1 AS TINYINT) TRV_FlagaVat
		,CAST(100.00 AS DECIMAL(15,2)) TRV_Netto
		,CAST(23.00 AS DECIMAL(15,2)) TRV_Vat
		,CAST(123.00 AS DECIMAL(15,2)) TRVBrutto
		,CAST(123.00 AS DECIMAL(15,2)) TRVTRPPozostaje
		,CAST(100.00 AS DECIMAL(15,2)) ZD_Netto
		,CAST(23.00 AS DECIMAL(15,2)) ZD_Vat
		,CAST(123.00 AS DECIMAL(15,2)) ZD_Brutto
		,CAST(1521 AS SMALLINT) TRP_GIDTyp
		,CAST(1111 AS INT) TRP_GIDNumer
		,CAST(1 AS SMALLINT) TRP_GIDLp		
		,CAST(2 AS SMALLINT) DokumentZD
		,CAST(2222 AS INT) TTV_GIDNumer
		,CAST(90000 AS INT) PEDDataStanuRozliczen
	UNION ALL
	SELECT		
		CAST(2 AS INT) TTV_VatNumer
		,CAST('ZD-6/2022' AS VARCHAR) TTV_NumerDokumentu
		,CAST('AAAZD-6/2022' AS VARCHAR)TTV_DokumentObcy
		,CAST(90000 AS INT) TTV_TrnData2
		,CAST(90000 AS INT)TRP_Termin
		,CAST('AkronimKNT' AS VARCHAR) KnA_Akronim
		,CAST('NazwaKNT' AS VARCHAR) KnANazwa
		,CAST('NIPKnt' AS VARCHAR) KNA_NIP
		,CAST(8.00 AS DECIMAL(5,2)) TRV_StawkaPod
		,CAST(1 AS TINYINT) TRV_FlagaVat
		,CAST(50.00 AS DECIMAL(15,2)) TRV_Netto
		,CAST(4.00 AS DECIMAL(15,2)) TRV_Vat
		,CAST(54.00 AS DECIMAL(15,2)) TRVBrutto
		,CAST(54.00 AS DECIMAL(15,2)) TRVTRPPozostaje
		,CAST(50.00 AS DECIMAL(15,2)) ZD_Netto
		,CAST(4.00 AS DECIMAL(15,2)) ZD_Vat
		,CAST(54.00 AS DECIMAL(15,2)) ZD_Brutto
		,CAST(1521 AS SMALLINT) TRP_GIDTyp
		,CAST(1111 AS INT) TRP_GIDNumer
		,CAST(1 AS SMALLINT) TRP_GIDLp		
		,CAST(2 AS SMALLINT) DokumentZD
		,CAST(2222 AS INT) TTV_GIDNumer
		,CAST(90000 AS INT) PEDDataStanuRozliczen
	RETURN
	--*/

	declare @SQLSyntax NVARCHAR(MAX)
	declare @SQL NVARCHAR(MAX)
	declare @Alias NVARCHAR(50)

	SET @SQL = N'##KSIListaRejestrVAT_ZD_'+CAST(@SesjaID AS NVARCHAR)+'_'+CAST(@Thread AS NVARCHAR)+N' @SQLSyntax output, @Alias output';
	EXEC sp_executeSQL @SQL
		,N'@SQLSyntax NVARCHAR(MAX) OUTPUT, @Alias NVARCHAR(50) OUTPUT'
		, @SQLSyntax=@SQLSyntax output
		, @Alias=@Alias output
	
	SET @SQL = @SQLSyntax + N'
		SELECT 
		TTV_VatNumer
		,TTV_NumerDokumentu
		,TTV_DokumentObcy
		,TTV_TrnData2
		,TRP_Termin
		,KnA_Akronim
		,KnANazwa
		,KNA_NIP
		,TRV_StawkaPod
		,TRV_FlagaVat
		,TRV_Netto
		,TRV_Vat
		,TRVBrutto
		,TRVTRPPozostaje
		,ZD_Netto
		,ZD_Vat
		,ZD_Brutto
		,TRP_GIDTyp
		,TRP_GIDNumer
		,TRP_GIDLp		
		,DokumentZD
		,TTV_GIDNumer
		,PED_DataStanuRozliczen PEDDataStanuRozliczen		
		FROM ' + @Alias 
		+ N' ORDER BY 
		CASE WHEN DokumentZD=0 THEN TTV_VatRejestr ELSE ''ZZZZZZZ'' END
		,CASE WHEN DokumentZD=0 THEN TTV_VatRok ELSE 0 END
		,CASE WHEN DokumentZD=0 THEN TTV_VatMiesiac ELSE 0 END
		,CASE WHEN DokumentZD=0 THEN TTV_VatDzien ELSE 0 END
		,CASE WHEN DokumentZD=0 THEN TTV_VatNumer ELSE 0 END		
		,TRP_GIDTyp, TRP_GIDNumer, TRP_GIDLp, DokumentZD, CASE WHEN DokumentZD&lt;&gt;0 THEN TTV_TRNData2 ELSE 0 END'

	EXEC sp_executeSQL @SQL
END
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>