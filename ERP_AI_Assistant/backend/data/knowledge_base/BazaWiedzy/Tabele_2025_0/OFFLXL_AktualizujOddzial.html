<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="OFFLXL_AktualizujOddzial"></A><PRE>
          <FONT SIZE="2"><I>/* OFFLXL_AktualizujOddzial */</I><BR>
CREATE PROCEDURE CDN.OFFLXL_AktualizujOddzial
	@PcK_PicoID INT,
	@PcK_MagNumer INT = 0,
	@PcK_MagZwrNumer INT = 0,
	@PcK_MagZamNumer INT = 0,
	@PcK_CentrumID INT,
	@PcK_TSSynchr INT = 0,
	@PcK_TSSynchrPtw INT = 0,
	@PcK_Stan SMALLINT,
	@PcK_EtapSynchronizacji SMALLINT,
	@PcK_PicoSMTP VARCHAR(200),
	@PcK_KatalogArchiwum VARCHAR(255),
	@PcK_KnGITyp SMALLINT = 0,
	@PcK_KnGINumer INT = 0,
	@PcK_ExpKnt SMALLINT = 0,
	@PcK_KnGETyp SMALLINT = 0,
	@PcK_KnGENumer INT = 0,
	@PcK_ExpKntTyp SMALLINT = 0,
	@PcK_ExpKntPlatnosci SMALLINT = 0,
	@PcK_TSSynchrKnt INT = 0,
	@PcK_TSSynchrKntPtw INT = 0,
	@PcK_ExpCennik SMALLINT = 0,
	@PcK_TwGTyp SMALLINT = 0,
	@PcK_TwGNumer INT = 0,
	@PcK_ExpCennikTyp SMALLINT = 0,
	@PcK_ExpCennikStanyZerowe SMALLINT = 0,
	@PcK_CenaZakupu SMALLINT = 0,
	@PcK_NrCeny SMALLINT = 0,
	@PcK_IloscCenAutonomicznych SMALLINT = 0,
	@PcK_NrCenyWzorcowej SMALLINT = 0,
	@PcK_NrCenyDomyslnej SMALLINT = 0,
	@PcK_TSSynchrTwr INT = 0,
	@PcK_TSSynchrTwrPtw INT = 0,
	@PcK_ExpPrm SMALLINT = 0,
	@PcK_ExpTwGTyp SMALLINT = 0,
	@PcK_ExpTwGNumer INT = 0,
	@PcK_ExpKnGTyp SMALLINT = 0,
	@PcK_ExpKnGNumer INT = 0,
	@PcK_ExpPrmTyp SMALLINT = 0,
	@PcK_TSSynchrPrm INT = 0,
	@PcK_TSSynchrPrmPtw INT = 0,
	@PcK_ExpGrup SMALLINT = 0,
	@PcK_ExpGrupTyp SMALLINT = 0,
	@PcK_TSSynchrGrup INT = 0,
	@PcK_TSSynchrGrupPtw INT = 0,
	@PcK_ZamPotwierdzaj SMALLINT = 0,
	@PcK_Blokady INT = 0,
	@PcK_MMInfo SMALLINT = 0,
	@PcK_SeriaRAK INT = 0,
	@PcK_LogFlag SMALLINT = 0,
	@PcK_IloscDniFAPA INT = 0,
	@PcK_AS SMALLINT = 0,
	@PcK_ASSerwer VARCHAR(255) = '',
	@PcK_ASKomp VARCHAR(64) = '',
	@PcK_ASTermin SMALLINT = 0,
	@PcK_ASTerminOd INT = 0,
	@PcK_ASTerminDo INT = 0,
	@PcK_TSSynchrKntO INT = 0,
	@PcK_Certyfikat VARCHAR(50) = '',
	@PcK_Typ SMALLINT
AS

/******* Jeżeli klient OfflineXLXL to tylko jeden wpis w PicoKonfig dla PcK_Typ = 0 *****/
IF (@PcK_Typ = 0 AND EXISTS(SELECT * FROM CDN.PicoKonfig WHERE PcK_Typ = 0 AND Pck_Stan = 0))
	BEGIN
		SELECT @PcK_PicoID
		RETURN
	END

IF @PcK_PicoID = 0
	BEGIN
	    SELECT @PcK_PicoID = ISNULL(MAX(PcK_PicoID),0) + 1 FROM CDN.PicoKonfig
		INSERT INTO CDN.PicoKonfig 
			  ( PcK_PicoID,
				PcK_MagNumer,
				PcK_MagZwrNumer,
				PcK_MagZamNumer,
				PcK_CentrumID,
				PcK_TSSynchr,
				PcK_TSSynchrPtw,
				PcK_Stan,
				PcK_EtapSynchronizacji,
				PcK_PicoSMTP,
				PcK_KatalogArchiwum,
				PcK_KnGITyp,
				PcK_KnGINumer,
				PcK_ExpKnt,
				PcK_KnGETyp,
				PcK_KnGENumer,
				PcK_ExpKntTyp,
				PcK_ExpKntPlatnosci,
				PcK_TSSynchrKnt,
				PcK_TSSynchrKntPtw,
				PcK_ExpCennik,
				PcK_TwGTyp,
				PcK_TwGNumer,
				PcK_ExpCennikTyp,
				PcK_ExpCennikStanyZerowe,
				PcK_CenaZakupu,
				PcK_NrCeny,
				PcK_IloscCenAutonomicznych,
				PcK_NrCenyWzorcowej,
				PcK_NrCenyDomyslnej,
				PcK_TSSynchrTwr,
				PcK_TSSynchrTwrPtw,
				PcK_ExpPrm,
				PcK_ExpTwGTyp,
				PcK_ExpTwGNumer,
				PcK_ExpKnGTyp,
				PcK_ExpKnGNumer,
				PcK_ExpPrmTyp,
				PcK_TSSynchrPrm,
				PcK_TSSynchrPrmPtw,
				PcK_ExpGrup,
				PcK_ExpGrupTyp,
				PcK_TSSynchrGrup,
				PcK_TSSynchrGrupPtw,
				PcK_ZamPotwierdzaj,
				PcK_Blokady,
				PcK_MMInfo,
				PcK_SeriaRAK,
				PcK_LogFlag,
				PcK_IloscDniFAPA,
				PcK_AS,
				PcK_ASSerwer,
				PcK_ASKomp,
				PcK_ASTermin,
				PcK_ASTerminOd,
				PcK_ASTerminDo,
				PcK_TSSynchrKntO,
				PcK_Certyfikat,
				PcK_Typ )
		VALUES (@PcK_PicoID,
				@PcK_MagNumer,
				@PcK_MagZwrNumer,
				@PcK_MagZamNumer,
				@PcK_CentrumID,
				@PcK_TSSynchr,
				@PcK_TSSynchrPtw,
				@PcK_Stan,
				@PcK_EtapSynchronizacji,
				@PcK_PicoSMTP,
				@PcK_KatalogArchiwum,
				@PcK_KnGITyp,
				@PcK_KnGINumer,
				@PcK_ExpKnt,
				@PcK_KnGETyp,
				@PcK_KnGENumer,
				@PcK_ExpKntTyp,
				@PcK_ExpKntPlatnosci,
				@PcK_TSSynchrKnt,
				@PcK_TSSynchrKntPtw,
				@PcK_ExpCennik,
				@PcK_TwGTyp,
				@PcK_TwGNumer,
				@PcK_ExpCennikTyp,
				@PcK_ExpCennikStanyZerowe,
				@PcK_CenaZakupu,
				@PcK_NrCeny,
				@PcK_IloscCenAutonomicznych,
				@PcK_NrCenyWzorcowej,
				@PcK_NrCenyDomyslnej,
				@PcK_TSSynchrTwr,
				@PcK_TSSynchrTwrPtw,
				@PcK_ExpPrm,
				@PcK_ExpTwGTyp,
				@PcK_ExpTwGNumer,
				@PcK_ExpKnGTyp,
				@PcK_ExpKnGNumer,
				@PcK_ExpPrmTyp,
				@PcK_TSSynchrPrm,
				@PcK_TSSynchrPrmPtw,
				@PcK_ExpGrup,
				@PcK_ExpGrupTyp,
				@PcK_TSSynchrGrup,
				@PcK_TSSynchrGrupPtw,
				@PcK_ZamPotwierdzaj,
				@PcK_Blokady,
				@PcK_MMInfo,
				@PcK_SeriaRAK,
				@PcK_LogFlag,
				@PcK_IloscDniFAPA,
				@PcK_AS,
				@PcK_ASSerwer,
				@PcK_ASKomp,
				@PcK_ASTermin,
				@PcK_ASTerminOd,
				@PcK_ASTerminDo,
				@PcK_TSSynchrKntO,
				@PcK_Certyfikat,
				@PcK_Typ )
	END
ELSE
	BEGIN
		UPDATE CDN.PicoKonfig 
		SET PcK_MagNumer = @PcK_MagNumer,
			PcK_MagZwrNumer = @PcK_MagZwrNumer,
			PcK_MagZamNumer = @PcK_MagZamNumer,
			PcK_CentrumID = @PcK_CentrumID,
			--PcK_TSSynchr = @PcK_TSSynchr,
			--PcK_TSSynchrPtw = @PcK_TSSynchrPtw,
			--PcK_Stan = @PcK_Stan,
			--PcK_EtapSynchronizacji = @PcK_EtapSynchronizacji,
			PcK_PicoSMTP = @PcK_PicoSMTP,
			PcK_KatalogArchiwum = @PcK_KatalogArchiwum,
			PcK_KnGITyp = @PcK_KnGITyp,
			PcK_KnGINumer = @PcK_KnGINumer,
			PcK_ExpKnt = @PcK_ExpKnt,
			PcK_KnGETyp = @PcK_KnGETyp,
			PcK_KnGENumer = @PcK_KnGENumer,
			PcK_ExpKntTyp = @PcK_ExpKntTyp,
			PcK_ExpKntPlatnosci = @PcK_ExpKntPlatnosci,
			--PcK_ExpKntFiltr = @PcK_ExpKntFiltr,
			--PcK_TSSynchrKnt = @PcK_TSSynchrKnt,
			--PcK_TSSynchrKntPtw = @PcK_TSSynchrKntPtw,
			PcK_ExpCennik = @PcK_ExpCennik,
			PcK_TwGTyp = @PcK_TwGTyp,
			PcK_TwGNumer = @PcK_TwGNumer,
			PcK_ExpCennikTyp = @PcK_ExpCennikTyp,
			PcK_ExpCennikStanyZerowe = @PcK_ExpCennikStanyZerowe,
			PcK_CenaZakupu = @PcK_CenaZakupu,
			PcK_NrCeny = @PcK_NrCeny,
			PcK_IloscCenAutonomicznych = @PcK_IloscCenAutonomicznych,
			PcK_NrCenyWzorcowej = @PcK_NrCenyWzorcowej,
			PcK_NrCenyDomyslnej = @PcK_NrCenyDomyslnej,
			--PcK_ExpCennikFiltr = @PcK_ExpCennikFiltr,
			--PcK_TSSynchrTwr = @PcK_TSSynchrTwr,
			--PcK_TSSynchrTwrPtw = @PcK_TSSynchrTwrPtw,
			PcK_ExpPrm = @PcK_ExpPrm,
			PcK_ExpTwGTyp = @PcK_ExpTwGTyp,
			PcK_ExpTwGNumer = @PcK_ExpTwGNumer,
			PcK_ExpKnGTyp = @PcK_ExpKnGTyp,
			PcK_ExpKnGNumer = @PcK_ExpKnGNumer,
			PcK_ExpPrmTyp = @PcK_ExpPrmTyp,
			--PcK_TSSynchrPrm = @PcK_TSSynchrPrm,
			--PcK_TSSynchrPrmPtw = @PcK_TSSynchrPrmPtw,
			PcK_ExpGrup = @PcK_ExpGrup,
			PcK_ExpGrupTyp = @PcK_ExpGrupTyp,
			--PcK_TSSynchrGrup = @PcK_TSSynchrGrup,
			--PcK_TSSynchrGrupPtw = @PcK_TSSynchrGrupPtw,
			PcK_ZamPotwierdzaj = @PcK_ZamPotwierdzaj,
			PcK_Blokady = @PcK_Blokady,
			PcK_MMInfo = @PcK_MMInfo,
			PcK_SeriaRAK = @PcK_SeriaRAK,
			PcK_LogFlag = @PcK_LogFlag,
			PcK_IloscDniFAPA = @PcK_IloscDniFAPA,
			PcK_AS = @PcK_AS,
			PcK_ASSerwer = @PcK_ASSerwer,
			PcK_ASKomp = @PcK_ASKomp,
			PcK_ASTermin = @PcK_ASTermin,
			PcK_ASTerminOd = @PcK_ASTerminOd,
			PcK_ASTerminDo = @PcK_ASTerminDo
			--PcK_TSSynchrKntO = @PcK_TSSynchrKntO,
			--PcK_Certyfikat = @PcK_Certyfikat,
			--PcK_Typ = @PcK_Typ
		WHERE PcK_PicoID = @PcK_PicoID
	END
SELECT @PcK_PicoID
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>