<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="ProdBOM"></A><PRE>
          <FONT SIZE="2"><I>/* ProdBOM */</I><BR>
CREATE FUNCTION CDN.ProdBOM(@Technologia int)
RETURNS @BOM TABLE (
  PTZ_Id int,
  PTZ_Kod varchar(60),
  PTZ_Nazwa varchar(300),
  Operacja varchar(370),
  PTZ_Ilosc decimal(11,4),
  PTZ_Jednostka varchar(8),
  PTZ_IloscPom decimal(11,4),
  PTZ_JednostkaPom varchar(8),
  PTZ_Zamiennik int,
  ZamiennikDo varchar(60),
  ZamiennikZaIle decimal(11,4),
  ZamiennikJm VARCHAR(8),
  PTZ_TypZasobu int,
  PTZ_TechnologiaZasob int,
  PTZ_TechnologiaCzynnosc int,
  PTZ_ZrodloZasobu tinyint,
  PTZ_TwrTyp smallint,
  PTZ_TwrNumer int,
  PTZ_IloscAtr int,
  PTZ_IloscMin decimal(11, 4),
  PTZ_IloscMinAtr int,
  PTZ_IloscMax decimal(11, 4),
  PTZ_IloscMaxAtr int,
  PTZ_PropIlosc smallint,
  PTZ_IloscPomAtr int,
  PTZ_IloscPomMin decimal(11, 4),
  PTZ_IloscPomMinAtr int,
  PTZ_IloscPomMax decimal(11, 4),
  PTZ_IloscPomMaxAtr int,
  PTZ_PropIloscPom smallint, 
  PTZ_MagNumer int,
  PTZ_Koszt tinyint,
  PTZ_Cena decimal(15, 4),
  PTZ_CenaAtr int,
  PTZ_KlasaCechy int,
  PTZ_Cecha varchar(255),
  PTZ_EdycjaCechy smallint,
  PTZ_WagaKosztu decimal(7, 2),
  PTZ_WagaIlosc tinyint,
  PTZ_IloscFormat tinyint,
  PTZ_Lp int,
  PTZ_DopasowanieIlosci decimal(5, 2),
  PTZ_PlanowanyCalosciowo tinyint,
  PTZ_KopTyp smallint,
  PTZ_KopNumer int,
  PTZ_Fakturowac tinyint,
  PTZ_CenaKosztorysu decimal(15, 4),
  PTZ_CenaKosztorysuAtr int,
  PTZ_IloscDomyslna tinyint,
  PTZ_IloscTechnologiczna tinyint,
  PTZ_Typ tinyint,
  PTZ_WymagajSurowca tinyint,
  PTZ_DefPytWyborId int,
  PTZ_DefPytCechaId int,
  PTZ_PlanujStrategicznie tinyint,
  PTZ_UsuwajNiewykorzystane tinyint,
  PTZ_RodzajUbocznego int ,
  PTZ_PlanujUboczne tinyint,
  PTZ_EdycjaMagazynuPrzyRealizacji tinyint,
  PTZ_PodstawowaTechnologiaDlaProduktu tinyint,
  PTZ_CzasTrwaniaProdukcji int,
  PTZ_CzasTrwaniaProdukcjiJedn tinyint,
  PTZ_PrzeliczajWgIlosciProduktu tinyint,
  PTZ_CzasTrwaniaWyliczony tinyint,
  PTZ_PodlegaKJ tinyint,
  PTZ_RodzajKJ tinyint,
  PTZ_IdProduktNiezgodny int,
  PTZ_IdMagazynNiezgodny int,
  PTZ_CzyUbocznyNiezgodny tinyint,
  PTZ_OpisKJ varchar(1023),
  PTZ_NiezaleznaOdJedPod tinyint,
  PTZ_PrzeliczajWgPomocniczej tinyint,
  PTZ_PrzeliczajIloscPomWgPodst tinyint
)
AS
BEGIN
    INSERT INTO @BOM (PTZ_Id, PTZ_Kod, PTZ_Nazwa, Operacja, PTZ_Ilosc, PTZ_Jednostka, PTZ_IloscPom, PTZ_JednostkaPom, PTZ_Zamiennik, ZamiennikDo, ZamiennikZaIle, ZamiennikJm, 
        PTZ_TypZasobu, PTZ_TechnologiaZasob, PTZ_TechnologiaCzynnosc,PTZ_TwrTyp,PTZ_TwrNumer,PTZ_IloscAtr,[PTZ_IloscMin],[PTZ_IloscMinAtr],[PTZ_IloscMax],
        [PTZ_IloscMaxAtr],[PTZ_PropIlosc],[PTZ_IloscPomAtr],[PTZ_IloscPomMin],[PTZ_IloscPomMinAtr],[PTZ_IloscPomMax],[PTZ_IloscPomMaxAtr],
        [PTZ_PropIloscPom],[PTZ_MagNumer],[PTZ_Koszt],[PTZ_Cena],[PTZ_CenaAtr],[PTZ_KlasaCechy],[PTZ_Cecha],[PTZ_EdycjaCechy],[PTZ_WagaKosztu],
        [PTZ_WagaIlosc],[PTZ_IloscFormat],[PTZ_Lp],[PTZ_DopasowanieIlosci],[PTZ_PlanowanyCalosciowo],[PTZ_KopTyp],[PTZ_KopNumer],[PTZ_Fakturowac],[PTZ_CenaKosztorysu],
        [PTZ_CenaKosztorysuAtr],[PTZ_IloscDomyslna],[PTZ_IloscTechnologiczna],[PTZ_Typ],[PTZ_WymagajSurowca],[PTZ_DefPytWyborId],[PTZ_DefPytCechaId],[PTZ_PlanujStrategicznie],
        [PTZ_UsuwajNiewykorzystane],[PTZ_RodzajUbocznego],[PTZ_PlanujUboczne],[PTZ_EdycjaMagazynuPrzyRealizacji],[PTZ_PodstawowaTechnologiaDlaProduktu],
        [PTZ_CzasTrwaniaProdukcji],[PTZ_CzasTrwaniaProdukcjiJedn],[PTZ_PrzeliczajWgIlosciProduktu],[PTZ_CzasTrwaniaWyliczony],[PTZ_PodlegaKJ],[PTZ_RodzajKJ],
        [PTZ_IdProduktNiezgodny],[PTZ_IdMagazynNiezgodny],[PTZ_CzyUbocznyNiezgodny],[PTZ_OpisKJ],[PTZ_NiezaleznaOdJedPod],[PTZ_PrzeliczajWgPomocniczej],
        [PTZ_PrzeliczajIloscPomWgPodst]) 
    SELECT  A.PTZ_Id, A.PTZ_Kod, A.PTZ_Nazwa, E.PTC_Kod  + ' ; ' + E.PTC_Nazwa, A.PTZ_Ilosc, A.PTZ_Jednostka, A.PTZ_IloscPom, A.PTZ_JednostkaPom, ISNULL(B.PTZ_Id, 0), B.PTZ_Kod, 
        B.PTZ_Ilosc, B.PTZ_Jednostka, A.PTZ_TypZasobu, A.PTZ_TechnologiaZasob, A.PTZ_TechnologiaCzynnosc,A.PTZ_TwrTyp,A.PTZ_TwrNumer,A.PTZ_IloscAtr,A.[PTZ_IloscMin],A.[PTZ_IloscMinAtr],
        A.[PTZ_IloscMax],A.[PTZ_IloscMaxAtr],A.[PTZ_PropIlosc],A.[PTZ_IloscPomAtr],A.[PTZ_IloscPomMin],A.[PTZ_IloscPomMinAtr],A.[PTZ_IloscPomMax],
        A.[PTZ_IloscPomMaxAtr],A.[PTZ_PropIloscPom],A.[PTZ_MagNumer],A.[PTZ_Koszt],A.[PTZ_Cena],A.[PTZ_CenaAtr],A.[PTZ_KlasaCechy],A.[PTZ_Cecha],
        A.[PTZ_EdycjaCechy],A.[PTZ_WagaKosztu],A.[PTZ_WagaIlosc],A.[PTZ_IloscFormat],A.[PTZ_Lp],A.[PTZ_DopasowanieIlosci],A.[PTZ_PlanowanyCalosciowo],A.[PTZ_KopTyp],A.[PTZ_KopNumer],
        A.[PTZ_Fakturowac],A.[PTZ_CenaKosztorysu],A.[PTZ_CenaKosztorysuAtr],A.[PTZ_IloscDomyslna],A.[PTZ_IloscTechnologiczna],A.[PTZ_Typ],A.[PTZ_WymagajSurowca],A.[PTZ_DefPytWyborId],
        A.[PTZ_DefPytCechaId],A.[PTZ_PlanujStrategicznie],A.[PTZ_UsuwajNiewykorzystane],A.[PTZ_RodzajUbocznego],A.[PTZ_PlanujUboczne],A.[PTZ_EdycjaMagazynuPrzyRealizacji],
        A.[PTZ_PodstawowaTechnologiaDlaProduktu],A.[PTZ_CzasTrwaniaProdukcji],A.[PTZ_CzasTrwaniaProdukcjiJedn],A.[PTZ_PrzeliczajWgIlosciProduktu],A.[PTZ_CzasTrwaniaWyliczony],
        A.[PTZ_PodlegaKJ],A.[PTZ_RodzajKJ],A.[PTZ_IdProduktNiezgodny],A.[PTZ_IdMagazynNiezgodny],A.[PTZ_CzyUbocznyNiezgodny],A.[PTZ_OpisKJ],A.[PTZ_NiezaleznaOdJedPod],
        A.[PTZ_PrzeliczajWgPomocniczej],A.[PTZ_PrzeliczajIloscPomWgPodst]
    FROM CDN.ProdTechnologiaZasoby A 
        LEFT OUTER JOIN CDN.ProdTechnologiaZasoby B ON  A.PTZ_Zamiennik= B.PTZ_Id 
        LEFT OUTER JOIN CDN.ProdTechnologiaZasoby C ON  A.PTZ_TechnologiaZasob= C.PTZ_Id 
        LEFT OUTER JOIN CDN.ProdTechnologiaCzynnosci D ON  C.PTZ_TechnologiaCzynnosc= D.PTC_Id 
        LEFT OUTER JOIN CDN.ProdTechnologiaCzynnosci E ON  A.PTZ_TechnologiaCzynnosc= E.PTC_Id 
    WHERE 
        ((E.PTC_Technologia = @Technologia and 
        (D.PTC_Technologia &lt;&gt; @Technologia or D.PTC_Technologia is null) and 
        ((A.PTZ_TypZasobu &lt;&gt; 0 and A.PTZ_TypZasobu &lt;&gt; 4 and A.PTZ_Zamiennik =0 and A.PTZ_TechnologiaZasob = 0) or 
        (A.PTZ_TypZasobu &lt;&gt; 0 and A.PTZ_TypZasobu &lt;&gt; 4 and A.PTZ_Zamiennik &lt;&gt;0 and A.PTZ_TechnologiaZasob = 0) or 
        (A.PTZ_TechnologiaZasob &gt; 0))))

    RETURN
END
</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>