<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="[FakturySprzedazyWgDeklaracjiVat]"></A><PRE>
          <FONT SIZE="2"><I>/* [FakturySprzedazyWgDeklaracjiVat] */</I><BR>
create procedure [CDN].[FakturySprzedazyWgDeklaracjiVat] (@miesiacKwartal tinyint, @kwartal tinyint, @miesiac tinyint, @rok smallint, @wersjaDeklaracji smallint = 12, @KntStatusVat tinyint=0, @KntStatusVatKod tinyint = 0) as
begin


	--declare @miesiacKwartal tinyint, @kwartal tinyint, @miesiac tinyint, @rok smallint, @wersjaDeklaracji smallint = 12, @KntStatusVat tinyint=0, @KntStatusVatKod tinyint = 0
	--select @miesiacKwartal = 0, @kwartal = 3, @miesiac = 7, @rok =2022, @wersjaDeklaracji = 21, @KntStatusVat = 0, @KntStatusVatKod = 0


	declare @konKwart tinyint
	declare @poczKwart tinyint
	set @poczKwart = ((@kwartal - 1) * 3) + 1
	set @konKwart = @poczKwart + 2

	--declare @statusVat tinyint = 0

	declare 
		@Typ_FW		int
		, @Typ_FWK  int
		, @Typ_FWS	int
		, @Typ_FKS	int
		
		, @g_ksi_lUwzgledniajNieopodatkowane tinyint
		, @g_ksi_lUwzgledniajZakup0zw tinyint
		, @g_ksi_InterpretujTransDostOpodatkPozaTerytKrajWSt0JakoKrajowa tinyint
		
	set @Typ_FW		= 2036
	set @Typ_FWK    = 2044	
	set @Typ_FWS	= 3379
	set @Typ_FKS	= 3387
		
	declare @GIDFirma int = 0
	select top 1 @GIDFirma = Ope_GIDFirma from cdn.OpeKarty
			
	set @g_ksi_lUwzgledniajNieopodatkowane = 0
	set @g_ksi_lUwzgledniajZakup0zw = 0

	declare @e_SPR_nNieEksportowy                     tinyint       -- nie eksportowy
	, @e_SPR_nEksportowyVat0                          tinyint       -- eksportowy VAT0%
	, @e_SPR_nEksportowyVatDowolny                    tinyint       -- eksportowy VAT dowolny
	, @e_SPR_nEksportowyVatDowolnyKorekta             tinyint       -- korekta vat dowolny  -&gt; vat eksportowy
	, @e_SPR_nEksportowyVat0Korekta                   tinyint       -- korekta vat eksportowy -&gt; vat dowolny
	, @e_SPR_nWewnatrzwspolnotowyVat0D                tinyint       -- Wewnątrzwspólnotowy dostawa Vat 0
	, @e_SPR_nWewnatrzwspolnotowyVatDowolnyD          tinyint       -- Wewnątrzwspólnotowy dostawa Vat dowolny
	, @e_SPR_nWewnatrzwspolnotowyVat0DT               tinyint       -- Wewnątrzwspólnotowa dostawa, trójstronna Vat 0,
	, @e_SPR_nWewnatrzwspolnotowyVatDowolnyDT         tinyint       -- Wewnątrzwspólnotowa dostawa, trójstronna Vat dowolny,
	, @e_SPR_nWewnatrzwspolnotowyVat0N                tinyint      -- Wewnątrzwspólnotowe nabycie Vat 0
	, @e_SPR_nWewnatrzwspolnotowyVatDowolnyN          tinyint      -- Wewnątrzwspólnotowe nabycie Vat dowolny
	, @e_SPR_nWewnatrzwspolnotowyVat0NT               tinyint      -- Wewnątrzwspólnotowe nabycie, trójstronne Vat 0
	, @e_SPR_nWewnatrzwspolnotowyVatDowolnyNT         tinyint      -- Wewnątrzwspólnotowe nabycie, trójstronne Vat dowolny
	, @e_SPR_nImportowyVat0FW                         tinyint      -- eksportowy VAT0% dla FWS
	, @e_SPR_nImportowyVatDowolnyFW                   tinyint      -- eksportowy VAT dowolny dla FWS
	, @e_SPR_nWewnatrzwspolnotowyVatDowolnyDKorekta   tinyint      -- korekta wewnątrzwspólnotowy dostawa Vat dowolny
	, @e_SPR_nWewnatrzwspolnotowyVat0DKorekta         tinyint      -- korekta wewnątrzwspólnotowy dostawa Vat 0
	, @e_SPR_nWewnatrzwspolnotowyVatDowolnyDTKorekta  tinyint      -- korekta wewnątrzwspólnotowa dostawa trójstronna Vat dowolny
	, @e_SPR_nWewnatrzwspolnotowyVat0DTKorekta        tinyint      -- korekta wewnątrzwspólnotowa dostawa trójstronna Vat 0
	, @e_SPR_nEksportowyNabywca                       tinyint      -- podatnikiem jest nabywca
	, @e_SPR_nDostawaOpodatkowanaWWsp                 tinyint      -- dostawa opodatkowana poza terytorium kraju
	, @e_SPR_nTaxFree                                 tinyint      -- tax free
	, @e_SPR_nDostawaOpodatkowanaInne                 tinyint      -- dostawa opodatkowana poza terytorium kraju
	, @e_SPR_nEksportowyNabywcaWsp					  tinyint      -- podatnikiem jest Nabywca (transakcja Wewnątrzwspólnotowa)
	, @e_SPR_nEksportowyNabywcaInne					  tinyint	   -- podatnikime jest Nabywca (transakcja Inna zagranicznia)
	, @e_SPR_nWSTO_EE								  tinyint	   -- WSTO_EE

	declare @e_ksi_lRodzajZakupu_Towary			tinyint
	declare @e_ksi_lRodzajZakupu_Koszty			tinyint
	declare @e_ksi_lRodzajZakupu_SrTrwale		tinyint
	declare @e_ksi_lRodzajZakupu_Inwestycje		tinyint
	declare @e_ksi_lRodzajZakupu_Nieruchomosci	tinyint
	declare @e_ksi_lRodzajZakupu_ImportUslug	tinyint
	declare @e_ksi_lRodzajZakupu_SrTransportu	tinyint
	declare @e_ksi_lRodzajZakupu_Paliwo			tinyint
	declare @e_ksi_lRodzajZakupu_UslugiRO		tinyint

	set @e_SPR_nNieEksportowy                     = 1       -- nie eksportowy
	set @e_SPR_nEksportowyVat0                    = 2       -- eksportowy VAT0%
	set @e_SPR_nEksportowyVatDowolny              = 3       -- eksportowy VAT dowolny
	set @e_SPR_nEksportowyVatDowolnyKorekta       = 4       -- korekta vat dowolny  -&gt; vat eksportowy
	set @e_SPR_nEksportowyVat0Korekta             = 5       -- korekta vat eksportowy -&gt; vat dowolny
	set @e_SPR_nWewnatrzwspolnotowyVat0D          = 6       -- Wewnątrzwspólnotowy dostawa Vat 0
	set @e_SPR_nWewnatrzwspolnotowyVatDowolnyD    = 7       -- Wewnątrzwspólnotowy dostawa Vat dowolny
	set @e_SPR_nWewnatrzwspolnotowyVat0DT         = 8       -- Wewnątrzwspólnotowa dostawa, trójstronna Vat 0,
	set @e_SPR_nWewnatrzwspolnotowyVatDowolnyDT   = 9       -- Wewnątrzwspólnotowa dostawa, trójstronna Vat dowolny,
	set @e_SPR_nWewnatrzwspolnotowyVat0N          = 10      -- Wewnątrzwspólnotowe nabycie Vat 0
	set @e_SPR_nWewnatrzwspolnotowyVatDowolnyN    = 11      -- Wewnątrzwspólnotowe nabycie Vat dowolny
	set @e_SPR_nWewnatrzwspolnotowyVat0NT         = 12      -- Wewnątrzwspólnotowe nabycie, trójstronne Vat 0
	set @e_SPR_nWewnatrzwspolnotowyVatDowolnyNT   = 13      -- Wewnątrzwspólnotowe nabycie, trójstronne Vat dowolny
	set @e_SPR_nImportowyVat0FW                   = 14      -- eksportowy VAT0% dla FWS
	set @e_SPR_nImportowyVatDowolnyFW             = 15      -- eksportowy VAT dowolny dla FWS
	set @e_SPR_nWewnatrzwspolnotowyVatDowolnyDKorekta   = 16      -- korekta wewnątrzwspólnotowy dostawa Vat dowolny
	set @e_SPR_nWewnatrzwspolnotowyVat0DKorekta         = 17      -- korekta wewnątrzwspólnotowy dostawa Vat 0
	set @e_SPR_nWewnatrzwspolnotowyVatDowolnyDTKorekta  = 18      -- korekta wewnątrzwspólnotowa dostawa trójstronna Vat dowolny
	set @e_SPR_nWewnatrzwspolnotowyVat0DTKorekta        = 19      -- korekta wewnątrzwspólnotowa dostawa trójstronna Vat 0
	set @e_SPR_nEksportowyNabywca                       = 20      -- podatnikiem jest nabywca
	set @e_SPR_nDostawaOpodatkowanaWWsp                 = 21      -- dostawa opodatkowana poza terytorium kraju
	set @e_SPR_nTaxFree                                 = 22      -- tax free
	set @e_SPR_nDostawaOpodatkowanaInne                 = 23      -- dostawa opodatkowana poza terytorium kraju
	set @e_SPR_nEksportowyNabywcaWsp	= 24      --podatnikiem jest Nabywca (transakcja Wewnątrzwspólnotowa)
	set @e_SPR_nEksportowyNabywcaInne	= 25      --podatnikime jest Nabywca (transakcja Inna zagranicznia)
	set @e_SPR_nWSTO_EE = 26
	
	set @e_ksi_lRodzajZakupu_Towary			= 1
	set @e_ksi_lRodzajZakupu_Koszty			= 2
	set @e_ksi_lRodzajZakupu_SrTrwale		= 3
	set @e_ksi_lRodzajZakupu_Inwestycje		= @e_ksi_lRodzajZakupu_SrTrwale
	set @e_ksi_lRodzajZakupu_Nieruchomosci	= 4
	set @e_ksi_lRodzajZakupu_ImportUslug	= 5
	set @e_ksi_lRodzajZakupu_SrTransportu	= 6
	set @e_ksi_lRodzajZakupu_Paliwo			= 7  
	set @e_ksi_lRodzajZakupu_UslugiRO		= 8	

	/*
	@e_ksi_lRodzajZakupu_Towary
	@e_ksi_lRodzajZakupu_Koszty
	@e_ksi_lRodzajZakupu_SrTrwale
	@e_ksi_lRodzajZakupu_Inwestycje
	@e_ksi_lRodzajZakupu_Nieruchomosci
	@e_ksi_lRodzajZakupu_ImportUslug
	@e_ksi_lRodzajZakupu_SrTransportu
	@e_ksi_lRodzajZakupu_Paliwo
	@e_ksi_lRodzajZakupu_UslugiRO
	*/

	declare @e_ksi_lOdliczeniaVAT_Tak	tinyint,
		@e_ksi_lOdliczeniaVAT_Nie		tinyint,
		@e_ksi_lOdliczeniaVAT_Warunkowo	tinyint
		
	set @e_ksi_lOdliczeniaVAT_Tak	 = 1
	set @e_ksi_lOdliczeniaVAT_Nie		= 2
	set @e_ksi_lOdliczeniaVAT_Warunkowo	= 3

	select @g_ksi_lUwzgledniajNieopodatkowane = CAST(KON_Wartosc as int) from cdn.Konfig where Kon_Numer = 2056
	select @g_ksi_lUwzgledniajZakup0zw = CAST(KON_Wartosc as int) from cdn.Konfig where Kon_Numer = 2071
	select @g_ksi_InterpretujTransDostOpodatkPozaTerytKrajWSt0JakoKrajowa = cast(KON_Wartosc as int) from cdn.Konfig where Kon_Numer = 20143

	create table #tmpWyn
	(	
		GIDTyp smallint, 
		GIDNumer int, 
		GIDLp smallint, 
		NrWRej int,
		Rejestr varchar(5),
		PoleNaDekl smallint,
		Odliczenie tinyint,		-- pełne, warunkowe (tak, nie, warunkowe)
		DataWystaw int,
		DataSprzed int,
		NrDok varchar(40),
		Akronim varchar(20),
		Nazwa varchar(200),
		Netto decimal(15,2),
		Vat decimal(15,2),
		VatNalOd tinyint,
		NIP varchar(20),
		KorektaDanych tinyint
	)	

	-------------------------------------------------------------------------------------------------------------------------------------
	
	;with aa as 
	(     
		SELECT TRV_GIDTyp, TRV_GIDNumer, TRV_GIDLp, TRN_VatRejestr, TrN_VatNumer
			, case when TrN_KorektaDanych &gt; 0 and TrN_DataWystOrg &gt; 0 then TrN_DataWystOrg else TrN_Data2 end DataWyst
			, case when TrN_KorektaDanych &gt; 0 and TrN_DataSprOrg &gt; 0 then TrN_DataSprOrg else TrN_Data3 end DataZak,
			CASE WHEN (TSV_NettoP+TSV_VatP) &lt;&gt; 0 THEN TSV_NettoP ELSE TSV_NettoR END as Netto,
			CASE WHEN (TSV_NettoP+TSV_VatP) &lt;&gt; 0 THEN TSV_VatP ELSE TSV_VatR END as Vat,
			TRV_StawkaPod, TRV_FlagaVat, TSV_RodzajZakupu, TRV_Struktura, 
			TRN_VatKorekta, TRV_ExpoNorm, TRV_Zrodlowa,
			TrV_KnANumer,TrN_KnANumer,TrN_AdPNumer,
		    
			TRN_VatRok, TRN_VatMiesiac, TRN_RolnikRyczalt, TRN_KorektaOdlicz, 0 as CzySad,
			case when TrN_DokumentObcy &lt;&gt; '' then TrN_DokumentObcy else CDN.NumerDokumentu(TrN_GIDTyp, TrN_SpiTyp,TrN_TrnTyp,TrN_TrnNumer,TrN_TrNRok,Trn_TrnSeria,TrN_TrnMiesiac) end as NumerDok			
			, TrV_VATNalOd			

			,TRV_KorektaDanych
			,TRN_TRNTyp
			,TrN_ProceduraOSS
		FROM CDN.TraVat 
		JOIN CDN.TraSVat ON TRV_GIDTyp = TSV_GIDTyp AND TRV_GIDNumer = TSV_GIDNumer AND TrV_GIDLp = TSV_GIDLp
		JOIN CDN.TraNag ON TRV_GIDTyp = TRN_GIDTyp AND TRV_GIDNumer = TRN_GIDNumer		

		WHERE TRN_VatTyp=2 AND TSV_Rozliczac=1 AND TSV_DeklRok = @rok
			AND ( (@miesiacKwartal = 0 AND TSV_DeklMiesiac = @miesiac) OR (@miesiacKwartal = 1 AND TSV_DeklMiesiac BETWEEN @poczKwart AND @konKwart) )
			AND TRN_VatRejestr &lt;&gt; ''
			AND (@KntStatusVat = 0 or (@KntStatusVat &gt; 0 
				AND exists 
				(
					select a.KnV_KnANumer, a.KnV_VATWynik from cdn.KntVAT a
					join 
					(select KnV_KnANumer, max(KnV_Data) KnVData from cdn.KntVAT group by KnV_KnANumer, KnV_Nip) b on a.KnV_KnANumer = b.KnV_KnANumer and a.KnV_Data = b.KnVData
					where @KntStatusVatKod = 0 and a.KnV_VATWynik in (0,9) or @KntStatusVatKod &gt; 0 and @KntStatusVatKod = a.KnV_VATWynik
				)))

		UNION ALL
			
		SELECT TRV_GIDTyp, TRV_GIDNumer, TRV_GIDLp, SaN_VatRejestr, SaN_VatNumer, SaN_DataWplywu DataWyst, SaN_DataZgloszenia DataZak,
			CASE WHEN (TSV_NettoP + TSV_VatP) &lt;&gt; 0 THEN TSV_NettoP ELSE TSV_NettoR END as Netto, 
			CASE WHEN (TSV_NettoP + TSV_VatP) &lt;&gt; 0 THEN TSV_VatP ELSE TSV_VatR END as Vat, 
			TRV_StawkaPod, TRV_FlagaVat, TSV_RodzajZakupu, TRV_Struktura, 0, TRV_ExpoNorm, TRV_Zrodlowa ,
		    TrV_KnANumer,SaN_KnANumer,SaN_AdPNumer,

			SAN_VatRok, SAN_VatMiesiac, 0, 0, 1,
			case when SaN_NumerSAD &lt;&gt; '' then SaN_NumerSAD else CDN.NumerDokumentu(SaN_GIDTyp,0,SaN_SaNTyp,SaN_SaNNumer,SaN_SaNRok,SaN_SaNSeria,SaN_SaNMiesiac) end
			, TrV_VATNalOd
			, 0
			,SAN_SANTyp, 0
		FROM CDN.TraVAT 
		JOIN CDN.TraSVat ON TRV_GIDTyp = TSV_GIDTyp AND TRV_GIDNumer = TSV_GIDNumer AND TrV_GIDLp = TSV_GIDLp
		JOIN CDN.SadNag ON TRV_GIDTyp = SAN_GIDTyp AND TRV_GIDNumer = SAN_GIDNumer		
		
		WHERE SAN_VatTyp = 2 AND TSV_Rozliczac = 1 AND TSV_DeklRok = @rok 
			AND ( (@miesiacKwartal = 0 AND TSV_DeklMiesiac = @miesiac) OR (@miesiacKwartal = 1 AND TSV_DeklMiesiac BETWEEN @poczKwart AND @konKwart) )
			AND SAN_VatRejestr &lt;&gt; '' AND SAN_GIDTyp in (@Typ_FWS, @Typ_FKS )			
			AND (@KntStatusVat = 0 or (@KntStatusVat &gt; 0 
				AND exists 
				(
					select a.KnV_KnANumer, a.KnV_VATWynik from cdn.KntVAT a
					join 
					(select KnV_KnANumer, max(KnV_Data) KnVData from cdn.KntVAT group by KnV_KnANumer, KnV_Nip) b on a.KnV_KnANumer = b.KnV_KnANumer and a.KnV_Data = b.KnVData
					where @KntStatusVatKod = 0 and a.KnV_VATWynik in (0,9) or @KntStatusVatKod &gt; 0 and @KntStatusVatKod = a.KnV_VATWynik
				)))
	)    
	
	SELECT TRV_GIDTyp, TRV_GIDNumer, TRV_GIDLp, TRN_VatRejestr, TrN_VatNumer
			, DataWyst
			, DataZak,
			Netto,
			Vat,
			TRV_StawkaPod, TRV_FlagaVat, TSV_RodzajZakupu, TRV_Struktura, 
			TRN_VatKorekta, TRV_ExpoNorm, TRV_Zrodlowa,
		    
			TRN_VatRok, TRN_VatMiesiac, TRN_RolnikRyczalt, TRN_KorektaOdlicz, CzySad,
			NumerDok

			, case when TrV_KnANumer = 0 then case when @GIDFirma in (736001, 570625) then trnkADP.KnA_Akronim else trnk.KnA_Akronim end else trvk.KnA_Akronim end Knt_Akronim
			, case when TrV_KnANumer = 0 then case when @GIDFirma in (736001, 570625) then trnkADP.KnA_Nazwa1 else trnk.KnA_Nazwa1 end else trvk.KnA_Nazwa1 end  + ' ' 
				+  case when TrV_KnANumer = 0 then case when @GIDFirma in (736001, 570625) then trnkADP.KnA_Nazwa2 else trnk.KnA_Nazwa2 end else trvk.KnA_Nazwa2 end 
				+ ' ' +  case when TrV_KnANumer = 0 then case when @GIDFirma in (736001, 570625) then trnkADP.KnA_Nazwa3 else trnk.KnA_Nazwa3 end else trvk.KnA_Nazwa3 end as KNTNazwa			
			, TrV_VATNalOd
			, case when TrV_KnANumer = 0 then case when @GIDFirma in (736001, 570625) then trnkADP.KnA_NipPrefiks else trnk.KnA_NipPrefiks end else trvk.KnA_NipPrefiks end + '' 
				+ case when TrV_KnANumer = 0 then case when @GIDFirma in (736001, 570625) then trnkADP.KnA_Nip else trnk.KnA_Nip end else trvk.KnA_Nip end NIP

			,TRV_KorektaDanych
			,TRN_TRNTyp
			,TrN_ProceduraOSS

			INTO #tmpDokumenty 
		FROM aa		
		LEFT JOIN CDN.KntAdresy trnk ON ( TRN_KNANumer = trnk.KnA_GIDNumer )	
		LEFT JOIN CDN.KntAdresy trnkADP ON ( TrN_AdPNumer = trnkADP.KnA_GIDNumer )	-- tfs 318633		
		LEFT JOIN cdn.KntAdresy trvk ON TrV_KnANumer = trvk.KnA_GIDNumer


	-------------------------------------------------------------------------------------------------------------------------------------     
	declare @TRV_GIDTyp smallint,
		@TRV_GIDNumer int, 
		@TRV_GIDLp int,
		@TRN_VatRejestr varchar(5), 
		@TrN_VatNumer int,
		@CzySad tinyint,
		@TypSad smallint,
		@DataWyst int,
		@DataZak int,
		@NumerDok varchar(40),
		@Akronim varchar(20),
		@Nazwa varchar(200),
		@Netto decimal(15,2),
		@Vat decimal(15,2),
		@TRV_StawkaPod tinyint,
		@TRV_FlagaVAT tinyint, 
		@TRV_DeklRok smallint, 
		@TRV_DeklMiesiac tinyint,
		@TRV_RodzajZakupu tinyint, 
		@TRV_OdliczeniaVat tinyint,
		@TRN_VatRok smallint, 
		@TRN_VatMiesiac tinyint, 
		@TRN_VatKorekta tinyint, 
		@TRV_ExpoNorm tinyint, 
		@Zero tinyint, 
		@TRN_RolnikRyczalt tinyint, 
		@TRN_KorektaOdlicz tinyint,
		@TRV_Struktura tinyint, 
		@TRV_Zrodlowa tinyint,
		@TRV_VatNalOd tinyint,
		@NIP varchar(20),
		@KorektaDanych tinyint,
		@TRNTyp smallint,
		@TRV_ProceduraOSS tinyint
	    
	declare @poleNaDekl			smallint
	declare @pole_DTSUZW		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSUPK		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSUPKa		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSU0			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSU0a		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSU3i5		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSU7i8		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_DTSU22i23		smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_WWDT			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_ET			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_WWNT			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_ITPR			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_IU			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_IUa			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_IURO			smallint		-- numeracja na podstawie VAT-7(12)
	declare @pole_WWNST			smallint		-- numeracja na podstawie VAT-7(12)
	
	set @poleNaDekl			= 0
	set @pole_DTSUZW		= 20		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSUPK		= 21		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSUPKa		= 22		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSU0			= 23		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSU0a		= 24		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSU3i5		= 25		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSU7i8		= 27		-- numeracja na podstawie VAT-7(12)
	set @pole_DTSU22i23		= 29		-- numeracja na podstawie VAT-7(12)
	set @pole_WWDT			= 31		-- numeracja na podstawie VAT-7(12)
	set @pole_ET			= 32		-- numeracja na podstawie VAT-7(12)
	set @pole_WWNT			= 33		-- numeracja na podstawie VAT-7(12)
	set @pole_ITPR			= 35		-- numeracja na podstawie VAT-7(12)
	set @pole_IU			= 37		-- numeracja na podstawie VAT-7(12)
	set @pole_IUa			= 39		-- numeracja na podstawie VAT-7(12)
	set @pole_IURO			= 41		-- numeracja na podstawie VAT-7(12)
	set @pole_WWNST			= 44		-- numeracja na podstawie VAT-7(12)
	

	declare curDok cursor for select * from #tmpDokumenty for read only
	open curDok

	fetch curDok into @TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatRejestr, @TrN_VatNumer, @DataWyst, @DataZak,
		@Netto, @Vat, @TRV_StawkaPod, @TRV_FlagaVAT, @TRV_RodzajZakupu, @TRV_Struktura, @TRN_VatKorekta,
		@TRV_ExpoNorm, @TRV_Zrodlowa, @TRN_VatRok, @TRN_VatMiesiac, @TRN_RolnikRyczalt, @TRN_KorektaOdlicz, @CzySad,
		@NumerDok, @Akronim, @Nazwa, @TRV_VatNalOd, @NIP, @KorektaDanych, @TRNTyp, @TRV_ProceduraOSS

	while @@FETCH_STATUS = 0
	begin
	
		/*select @TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatRejestr, @TrN_VatNumer, @DataWyst, @DataZak,
			@Netto, @Vat, @TRV_StawkaPod, @TRV_FlagaVAT, @TRV_RodzajZakupu, @TRV_Struktura, @TRN_VatKorekta,
			@TRV_ExpoNorm, @TRV_Zrodlowa, @TRN_VatRok, @TRN_VatMiesiac, @TRN_RolnikRyczalt, @TRN_KorektaOdlicz, @CzySad,
			@NumerDok, @Akronim, @Nazwa	--*/
		
		IF @wersjaDeklaracji &gt; 16 AND @TRV_VatNalOd &gt; 0 and @TRV_GIDTyp IN (@Typ_FW, @Typ_FWK)
		BEGIN			
			IF @TRV_VatNalOd = 1			
				set @poleNaDekl = 36
			ELSE IF @TRV_VatNalOd = 2
				set @poleNaDekl = 37
			ELSE IF @TRV_VatNalOd = 3
				set @poleNaDekl = 38
			ELSE
				set @poleNaDekl = 39
			
				
			if @wersjaDeklaracji &gt;= 21
				set @poleNaDekl = @poleNaDekl - 3

			insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok, Akronim, Nazwa, Netto, Vat, VatNalOd, NIP, KorektaDanych)
			values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, @NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
		END
		ELSE
		IF NOT (@TRV_StawkaPod = 3 and @wersjaDeklaracji &gt; 15)		
		BEGIN
			IF ( ( ( @TRV_ExpoNorm IN (@e_SPR_nImportowyVat0FW, @e_SPR_nImportowyVatDowolnyFW) AND @TRV_GIDTyp IN (@Typ_FW, @Typ_FWK) ) 
			   or ( @TRV_GIDTyp IN (@Typ_FWS, @Typ_FKS) and @TRV_ExpoNorm = @e_SPR_nEksportowyVat0) ) 
				   AND @TRV_RodzajZakupu &lt;&gt; @e_ksi_lRodzajZakupu_ImportUslug )
			begin
				--IF NOT (@TRV_ExpoNorm = @e_SPR_nImportowyVatDowolnyFW AND @TRV_FlagaVAT = 2)		
				IF NOT ((@TRV_ExpoNorm IN (@e_SPR_nImportowyVatDowolnyFW,@e_SPR_nImportowyVat0FW) AND @TRV_GIDTyp IN (@Typ_FW, @Typ_FWK) OR ( @TRV_GIDTyp IN (@Typ_FWS, @Typ_FKS) and @TRV_ExpoNorm = @e_SPR_nEksportowyVat0)) AND @TRV_FlagaVAT = 2)
					IF (@g_ksi_lUwzgledniajNieopodatkowane = 0 AND @TRV_FlagaVAT &lt;&gt; 2) OR @g_ksi_lUwzgledniajNieopodatkowane = 1
					BEGIN
						set @poleNaDekl = 35
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
					
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
					END
					
			end
			else
			begin

				IF @TRV_ExpoNorm = @e_SPR_nEksportowyNabywca 
				begin
				
					set @poleNaDekl = -1
				
					IF @wersjaDeklaracji &lt; 14
					begin			
						--wart_DTPN_Netto = wart_DTPN_Netto + @Netto;       -- pole 41
						--wart_DTPN_Vat = wart_DTPN_Vat + @Vat;             -- pole 42
						set @poleNaDekl = 41
					end
					else if  @wersjaDeklaracji &lt; 15
					begin
						if @TRV_GIDTyp in (@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK )
						begin
							set @poleNaDekl = 31
							set @TRV_StawkaPod = 0
							set @TRV_FlagaVAT = 2
						end
						else
						begin
							if @TRV_FlagaVAT = 0
								set @poleNaDekl = 10
							else if @TRV_FlagaVAT = 2 and @TRV_StawkaPod = 0
								set @poleNaDekl = 31
							else if @TRV_FlagaVAT = 1
								begin
									if @TRV_StawkaPod = 0
										set @poleNaDekl = 13
									else if @TRV_StawkaPod in (3, 5)
										set @poleNaDekl = 15
									else if @TRV_StawkaPod in (7, 8)
										set @poleNaDekl = 17								
									else if @TRV_StawkaPod in (22, 23)
										set @poleNaDekl = 19								
								end	
						  
						end	
					end
					else
					begin
						if (@TRV_GIDTyp in (@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK )	)
							OR (@wersjaDeklaracji &gt;= 21 AND (@Rok&gt;2023 or @Rok=2023 and @miesiac&gt;=4))
						begin
							if @TRV_FlagaVAT &lt;&gt; 2 AND @wersjaDeklaracji &lt; 21
								set @poleNaDekl = 34
							else if @wersjaDeklaracji &gt;= 21
								set @poleNaDekl = 31
						end
						else
						begin
							if @TRV_RodzajZakupu IN (1, 5) 
								if @TRV_FlagaVAT = 0
									set @poleNaDekl = 10
								else if @TRV_FlagaVAT = 2 and @TRV_StawkaPod = 0 AND @wersjaDeklaracji &lt; 21
									set @poleNaDekl = 31		-- nowe 31
								else if @TRV_FlagaVAT = 1
								begin
									if @TRV_StawkaPod = 0
										set @poleNaDekl = 13
									else if @TRV_StawkaPod in (3, 5)
										set @poleNaDekl = 15
									else if @TRV_StawkaPod in (7, 8)
										set @poleNaDekl = 17
									else if @TRV_StawkaPod in (22, 23)
										set @poleNaDekl = 19
								end	
						  
						end	
					  
					end	
					
					if @poleNaDekl &gt; -1				
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
	        				Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
					
				end
				
				ELSE IF @TRV_ExpoNorm in (@e_SPR_nEksportowyNabywcaWsp,	@e_SPR_nEksportowyNabywcaInne)
				begin
					if @wersjaDeklaracji &lt; 15
					begin
						set @poleNaDekl = -1
						
						if @TRV_GIDTyp in (@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK )

							if @TRV_FlagaVAT &lt;&gt; 2 
								if @TRV_RodzajZakupu = 1
									set @poleNaDekl = 41
								else if @TRV_RodzajZakupu = 5
									set @poleNaDekl = 37

								else if @TRV_RodzajZakupu = 8 and @TRV_ExpoNorm = @e_SPR_nEksportowyNabywcaWsp
								begin							
									set @poleNaDekl = 39
									
									if @wersjaDeklaracji &gt;= 14								
										set @poleNaDekl = @poleNaDekl - 10
							
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
	        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
										
									set @poleNaDekl = 37								
								end
									
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
				
				
						if @poleNaDekl &gt; -1
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
	        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
					end
					else	-- if @wersjaDeklaracji = 15
					begin
						set @poleNaDekl = -1
						if @TRV_GIDTyp in (@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK )						
							if @TRV_FlagaVAT &lt;&gt; 2 
								if @TRV_RodzajZakupu = 1 AND @wersjaDeklaracji &lt; 21								
									set @poleNaDekl = 32
								else if @TRV_RodzajZakupu = 1 AND @wersjaDeklaracji &gt;= 21
									set @poleNaDekl = 31
								else if @TRV_RodzajZakupu = 5
									set @poleNaDekl = 27
								else if @TRV_RodzajZakupu = 8 and @TRV_ExpoNorm in (@e_SPR_nEksportowyNabywcaWsp, @e_SPR_nEksportowyNabywcaInne)
									set @poleNaDekl = 29
							if @wersjaDeklaracji &gt; 20
								if @TRV_FlagaVAT = 2 AND @TRV_RodzajZakupu = 1
									set @poleNaDekl = 31
				
						if @poleNaDekl &gt; -1
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
	        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
					end
				end
				
				ELSE IF @TRV_ExpoNorm = @e_SPR_nDostawaOpodatkowanaWWsp 
				begin
					if ( @TRV_StawkaPod = 0 and @TRV_FlagaVat = 2 and @TRV_RodzajZakupu IN (1, 5) ) 
					begin
						--wart_DTSU = wart_DTSU + @Netto;                  -- pole 21
			        
						set @poleNaDekl = 21
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
			            				
					end       
					else if @TRV_RodzajZakupu = 8 
					begin
						--wart_DTSU = wart_DTSU + @Netto;                  -- pole 21
						--wart_DTSU_a = wart_DTSU_a + @Netto;              -- pole 22
			            
						set @poleNaDekl = 21
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
							
						set @poleNaDekl = 22
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

					end;

					IF @TRV_RodzajZakupu IN (1, 5) 
					begin
						if @TRV_StawkaPod = 0 and @TRV_FlagaVat = 0 
						begin
							--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20            
			                		                
							set @poleNaDekl = 20
						
							if @wersjaDeklaracji = 14
								set @poleNaDekl = @poleNaDekl - 10
							else if @wersjaDeklaracji &gt;= 15
								set @poleNaDekl = 11
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						else if @TRV_StawkaPod = 0 and @TRV_FlagaVat = 1  
						begin
							--wart_DTSU_0 = wart_DTSU_0 + @Netto;              -- pole 23
							set @poleNaDekl = 23
						
							if @wersjaDeklaracji = 14
								set @poleNaDekl = @poleNaDekl - 10
							else if @wersjaDeklaracji &gt;= 15
								set @poleNaDekl = 11
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						else if (@TRV_StawkaPod = 3 and @wersjaDeklaracji &lt; 16 or @TRV_StawkaPod = 5 ) and @TRV_FlagaVat = 1 
						begin
							--wart_DTSU_3_5_Netto = wart_DTSU_3_5_Netto + @Netto;       -- pole 25
							--wart_DTSU_3_5_Vat = wart_DTSU_3_5_Vat + @Vat;             -- pole 26
							set @poleNaDekl = 25
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						else if (@TRV_StawkaPod = 7 or @TRV_StawkaPod = 8) and @TRV_FlagaVat = 1 
						begin
							--wart_DTSU_7_8_Netto = wart_DTSU_7_8_Netto + @Netto;      -- pole 27
							--wart_DTSU_7_8_Vat = wart_DTSU_7_8_Vat + @Vat;            -- pole 28
							set @poleNaDekl = 27
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						else if (@TRV_StawkaPod = 22 or @TRV_StawkaPod = 23) and @TRV_FlagaVat = 1 
						begin
							--wart_DTSU_22_23_Netto = wart_DTSU_22_23_Netto + @Netto;    -- pole 29
							--wart_DTSU_22_23_Vat = wart_DTSU_22_23_Vat + @Vat;          -- pole 30
							set @poleNaDekl = 29
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
					end
				end
				ELSE IF @TRV_ExpoNorm = @e_SPR_nWSTO_EE 
				begin
					IF @TRV_ProceduraOSS = 0
					begin
						--wart_DTSU = wart_DTSU + @Netto;                  -- pole 21
			        
						set @poleNaDekl = 21
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
			            				
					end
				end

				ELSE IF @TRV_ExpoNorm = @e_SPR_nDostawaOpodatkowanaInne 
				begin

					if NOT (@TRV_FlagaVAT = 2 and @TRV_RodzajZakupu NOT IN (@e_ksi_lRodzajZakupu_UslugiRO, @e_ksi_lRodzajZakupu_ImportUslug, @e_ksi_lRodzajZakupu_Towary))
					begin
						if @TRV_FlagaVAT = 1 and @TRV_StawkaPod = 0 and @g_ksi_InterpretujTransDostOpodatkPozaTerytKrajWSt0JakoKrajowa &gt; 0
							set @poleNaDekl = 23	-- pole 23
						else
							set @poleNaDekl = 21	--wart_DTSU = wart_DTSU + @Netto;                  -- pole 21
							
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
    						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
					end

				end
				ELSE IF @TRV_ExpoNorm = @e_SPR_nTaxFree 
				begin
					IF @TRV_FlagaVat = 1  
					begin    
						  --_VATQ:FlagaVat = qSumy.FlagaVat
						  --_VATQ:Stawka = qSumy.StawkaPod
						IF @TRV_StawkaPod = 0 
						begin
							--wart_DTSU_0 = wart_DTSU_0 + @Netto;              -- pole 23
							set @poleNaDekl = 23
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
								
							--wart_DTTF = @Netto     -- pole 24
							set @poleNaDekl = 24
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						ELSE IF (@TRV_StawkaPod = 3 or @TRV_StawkaPod = 5 )
						begin
							--wart_DTSU_3_5_Netto = wart_DTSU_3_5_Netto + @Netto;       -- pole 25
							--wart_DTSU_3_5_Vat = wart_DTSU_3_5_Vat + @Vat;             -- pole 26
							set @poleNaDekl = 25
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
    							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						ELSE IF (@TRV_StawkaPod = 7 or @TRV_StawkaPod = 8)
						begin
							--wart_DTSU_7_8_Netto = wart_DTSU_7_8_Netto + @Netto;      -- pole 27
							--wart_DTSU_7_8_Vat = wart_DTSU_7_8_Vat + @Vat;            -- pole 28
							set @poleNaDekl = 27
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
    							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						ELSE IF (@TRV_StawkaPod = 22 or @TRV_StawkaPod = 23)
						begin
							--wart_DTSU_22_23_Netto = wart_DTSU_22_23_Netto + @Netto;    -- pole 29
							--wart_DTSU_22_23_Vat = wart_DTSU_22_23_Vat + @Vat;          -- pole 30
							set @poleNaDekl = 29
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
    							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end					
					end
				end
				ELSE IF @TRV_ExpoNorm IN (@e_SPR_nWewnatrzwspolnotowyVat0N, @e_SPR_nWewnatrzwspolnotowyVatDowolnyN,
						 @e_SPR_nWewnatrzwspolnotowyVat0NT, @e_SPR_nWewnatrzwspolnotowyVatDowolnyNT,
						 @e_SPR_nImportowyVat0FW, @e_SPR_nImportowyVatDowolnyFW) 
				begin    
					IF @TRV_GIDTyp in(@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK) 
					BEGIN
						IF @TRV_FlagaVAT &lt;&gt; 2
						BEGIN
							IF @TRV_RodzajZakupu = @e_ksi_lRodzajZakupu_ImportUslug
							begin
								if @TRV_GIDTyp in (@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK) 
								begin
									--wart_IU_Netto = wart_IU_Netto + @Netto;            -- pole 37
									--wart_IU_Vat = wart_IU_Vat + @Vat;              -- pole 38
									set @poleNaDekl = 37
							
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

								end
								else
								begin
									--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20
									set @poleNaDekl = 20
							
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
								end
							end
							ELSE IF @TRV_RodzajZakupu = @e_ksi_lRodzajZakupu_UslugiRO  
							begin
								if @TRV_GIDTyp in (@Typ_FWS, @Typ_FKS, @Typ_FW, @Typ_FWK) 
								begin
									--wart_IU_Netto = wart_IU_Netto + @Netto;           -- pole 37
									--wart_IU_Vat = wart_IU_Vat + @Vat;                 -- pole 38
									if @wersjaDeklaracji &lt; 15
									begin
										set @poleNaDekl = 37
								
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
										
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        									Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
									end
										
									--wart_IU_RO_Netto = wart_IU_RO_Netto + @Netto;     -- pole 39
									--wart_IU_RO_Vat = wart_IU_RO_Vat + @Vat;           -- pole 40
									set @poleNaDekl = 39
							
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

								end
								else
								begin
									--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20
									set @poleNaDekl = 20
							
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
								end
							end
							ELSE IF @TRV_RodzajZakupu = @e_ksi_lRodzajZakupu_SrTransportu
							begin
								--wart_WWNT_Netto = wart_WWNT_Netto + @Netto;       -- pole 33
								--wart_WWNT_Vat = wart_WWNT_Vat + @Vat;             -- pole 34
								set @poleNaDekl = 33
							
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
									
								set @poleNaDekl = 44
							
								if @wersjaDeklaracji &gt;= 14 and @wersjaDeklaracji &lt; 15 and @wersjaDeklaracji &lt; 21
									set @poleNaDekl = @poleNaDekl - 10
								else if @wersjaDeklaracji &gt;= 17
								begin
									if @wersjaDeklaracji &lt; 21
										set @poleNaDekl = 38
									else
										set @poleNaDekl = 35

									set @Netto = 0
								end									
								else if @wersjaDeklaracji &gt;= 15
								begin
									if @wersjaDeklaracji &lt; 21
										set @poleNaDekl = 37
									else
										set @poleNaDekl = 34
								end
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

							end
							ELSE
							begin
								--wart_WWNT_Netto = wart_WWNT_Netto + @Netto;       -- pole 33
								--wart_WWNT_Vat = wart_WWNT_Vat + @Vat;             -- pole 34
								set @poleNaDekl = 33
							
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

								IF @wersjaDeklaracji &gt;= 17 AND @TRV_RodzajZakupu = @e_ksi_lRodzajZakupu_Paliwo
								begin
									if @wersjaDeklaracji &lt; 21
										set @poleNaDekl = 39			-- nowe na VAT-7 (17)
									else
										set @poleNaDekl = 36

									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, 0.00, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								end

							end
						END													
						ELSE IF @wersjaDeklaracji &gt;= 17 AND @TRV_RodzajZakupu = 1 AND
							 ( (@TRV_ExpoNorm = @e_SPR_nWewnatrzwspolnotowyVatDowolnyNT AND @TRV_GIDTyp in(@Typ_FW, @Typ_FWK) ) OR 
							   (@TRV_ExpoNorm = @e_SPR_nWewnatrzwspolnotowyVat0NT AND @TRV_GIDTyp in(@Typ_FWS, @Typ_FKS) ) )
						BEGIN
							set @poleNaDekl = 23
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
    							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
						END
					END
				end
				ELSE IF @TRV_ExpoNorm IN (@e_SPR_nWewnatrzwspolnotowyVat0D, @e_SPR_nWewnatrzwspolnotowyVat0DT,
					  @e_SPR_nWewnatrzwspolnotowyVatDowolnyD, @e_SPR_nWewnatrzwspolnotowyVatDowolnyDT,
					  @e_SPR_nWewnatrzwspolnotowyVatDowolnyDKorekta, @e_SPR_nWewnatrzwspolnotowyVat0DKorekta) 
				begin
					IF @TRV_RodzajZakupu = 8   
					begin
						--wart_DTSU = wart_DTSU + @Netto;              -- pole 21
						--wart_DTSU_a = wart_DTSU_a + @Netto;              -- pole 22
						set @poleNaDekl = 21
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
						
						set @poleNaDekl = 22
						
						if @wersjaDeklaracji &gt;= 14
							set @poleNaDekl = @poleNaDekl - 10
						
						insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        					Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
						values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
							@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
				
					end;

					IF @TRV_StawkaPod &lt;&gt; 0 AND @TRV_FlagaVat = 1  
					begin
						IF @TRV_RodzajZakupu IN (1, 5) 
						begin
							if (@TRV_StawkaPod = 3 or @TRV_StawkaPod = 5 ) and @TRV_FlagaVat = 1 
							begin
								--wart_DTSU_3_5_Netto = wart_DTSU_3_5_Netto + @Netto;      -- pole 25
								--wart_DTSU_3_5_Vat = wart_DTSU_3_5_Vat + @Vat;        -- pole 26
								set @poleNaDekl = 25
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
							
							end
							else if (@TRV_StawkaPod = 7 or @TRV_StawkaPod = 8 ) and @TRV_FlagaVat = 1 
							begin
								--wart_DTSU_7_8_Netto = wart_DTSU_7_8_Netto + @Netto;      -- pole 27
								--wart_DTSU_7_8_Vat = wart_DTSU_7_8_Vat + @Vat;        -- pole 28
								set @poleNaDekl = 27
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
			                    
							end
							else if (@TRV_StawkaPod = 22 or @TRV_StawkaPod = 23 ) and @TRV_FlagaVat = 1 
							begin
								--wart_DTSU_22_23_Netto = wart_DTSU_22_23_Netto + @Netto;    -- pole 29
								--wart_DTSU_22_23_Vat = wart_DTSU_22_23_Vat + @Vat;      -- pole 30
								set @poleNaDekl = 29
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
							
							end            
						end
					end
					ELSE IF @TRV_StawkaPod = 0 AND @TRV_FlagaVat = 2 
					begin         
						IF @TRV_RodzajZakupu IN (1, 5) 
						begin
							--wart_DTSU = wart_DTSU + @Netto;                -- pole 21
							set @poleNaDekl = 21
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end           
					end
					ELSE
					begin
						IF @TRV_RodzajZakupu = 1 AND @TRV_StawkaPod = 0 AND @TRV_FlagaVat = 1 
						begin
							--wart_WWDT = wart_WWDT + @Netto;                -- pole 31
							set @poleNaDekl = 31
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end;        
			        
						IF @TRV_RodzajZakupu in (1, 5) AND @TRV_FlagaVat = 0 
						begin
							--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20
							set @poleNaDekl = 20
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end;

						IF @TRV_RodzajZakupu = 5 AND @TRV_FlagaVat = 1 
						begin
							--wart_DTSU_0 = wart_DTSU_0 + @Netto;              -- pole 23
							set @poleNaDekl = 23
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end            
					end
				end
				ELSE
				begin
					IF (@TRV_ExpoNorm IN (@e_SPR_nImportowyVat0FW, @e_SPR_nImportowyVatDowolnyFW) AND
						@TRV_GIDTyp IN (@Typ_FW, @Typ_FWK)) OR
					   (@TRV_GIDTyp IN (@Typ_FWS, @Typ_FKS) and @TRV_ExpoNorm = @e_SPR_nEksportowyVat0)
			        
					begin

						IF @TRV_StawkaPod = 0 AND @TRV_FlagaVat = 2 
						begin
							IF @g_ksi_lUwzgledniajNieopodatkowane = 1 
								if @TRV_RodzajZakupu = 5     --@e_ksi_lRodzajZakupu_ImportUslug
								begin                    
									--wart_IU_Netto = wart_IU_Netto + @Netto;    -- pole 37
									--wart_IU_Vat   = wart_IU_Vat + @Vat;        -- pole 38
									if not ( @TRV_GIDTyp IN (@Typ_FWS, @Typ_FKS) and @TRV_ExpoNorm = @e_SPR_nEksportowyVat0  )	--and @wersjaDeklaracji = 15 )
									begin
										set @poleNaDekl = 37
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
									
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        									Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
									end

								end  
								else if @TRV_RodzajZakupu = 8    --@e_ksi_lRodzajZakupu_UslugiRO
								begin
			                    
									if not ( @TRV_GIDTyp IN (@Typ_FWS, @Typ_FKS) and @TRV_ExpoNorm = @e_SPR_nEksportowyVat0 )	--and @wersjaDeklaracji = 15 )
									begin
										--wart_IU_Netto       = wart_IU_Netto + @Netto;    -- pole 37
										--wart_IU_Vat         = wart_IU_Vat + @Vat;        -- pole 38
										set @poleNaDekl = 37
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
									
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
	        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
							
										--wart_IU_RO_Netto    = wart_IU_RO_Netto + @Netto;    -- pole 39
										--wart_IU_RO_Vat      = wart_IU_RO_Vat + @Vat;        -- pole 40
										set @poleNaDekl = 39
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
									
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        									Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
									end

								end
						end   
						ELSE
						begin
							if @TRV_RodzajZakupu = 5       --@e_ksi_lRodzajZakupu_ImportUslug
							begin
								--wart_IU_Netto       = wart_IU_Netto + @Netto;    -- pole 37
								--wart_IU_Vat         = wart_IU_Vat + @Vat;        -- pole 38
								set @poleNaDekl = 37
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

							end    
							else if @TRV_RodzajZakupu = 8       --@e_ksi_lRodzajZakupu_UslugiRO
							begin
								--wart_IU_Netto       = wart_IU_Netto + @Netto;    -- pole 37
								--wart_IU_Vat         = wart_IU_Vat + @Vat;        -- pole 38
								set @poleNaDekl = 37
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
									
								--wart_IU_RO_Netto    = wart_IU_RO_Netto + @Netto;    -- pole 39
								--wart_IU_RO_Vat      = wart_IU_RO_Vat + @Vat;        -- pole 40
								set @poleNaDekl = 39
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)

							end
						end
					end
					ELSE IF @TRN_VatKorekta = 1 
					begin
						IF @TRV_FlagaVat = 1     -- normalny podatek
						begin
							IF @TRV_StawkaPod = 0 AND (@TRV_ExpoNorm = 2 OR @TRV_ExpoNorm = 4) 
							begin
								--wart_ExT = wart_ExT + @Netto;     -- pole 32
								set @poleNaDekl = 32
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

							end
							ELSE IF (@TRV_RodzajZakupu &lt;&gt; 8 AND
								NOT (@TRV_RodzajZakupu = 1 AND @TRV_StawkaPod = 0 AND
								 @TRV_ExpoNorm IN (@e_SPR_nWewnatrzwspolnotowyVatDowolnyDTKorekta, @e_SPR_nWewnatrzwspolnotowyVat0DTKorekta))) 
							begin
								IF @TRV_StawkaPod = 0
								BEGIN
									--wart_DTSU_0 = wart_DTSU_0 + @Netto;              -- pole 23
									set @poleNaDekl = 23
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
								END
								ELSE IF @TRV_StawkaPod IN (3,5)
								BEGIN								
									set @poleNaDekl = 25
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								END
								ELSE IF @TRV_StawkaPod IN (7,8)
								BEGIN								
									set @poleNaDekl = 27
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								END
								ELSE IF @TRV_StawkaPod IN (22,23)
								BEGIN								
									set @poleNaDekl = 29
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								END
							end;
			          
							IF @TRV_ExpoNorm IN (@e_SPR_nWewnatrzwspolnotowyVatDowolnyDTKorekta, @e_SPR_nWewnatrzwspolnotowyVat0DTKorekta) 
							begin
								IF (@TRV_RodzajZakupu = 8) 
								begin								
									--wart_DTSU = wart_DTSU + @Netto;              -- pole 21
									--wart_DTSU_a = wart_DTSU_a + @Netto;              -- pole 22
									set @poleNaDekl = 21
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
										
									set @poleNaDekl = 22
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

								end;

								IF @TRV_RodzajZakupu = 1 AND @TRV_StawkaPod = 0 
								begin
									--wart_WWDT = wart_WWDT + @Netto;                -- pole 31
									set @poleNaDekl = 31								
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

								end
							end
			            
						end            
						ELSE IF @TRV_FlagaVat IN (0,2)  
						begin
							IF @TRV_FlagaVat = 2 AND @g_ksi_lUwzgledniajNieopodatkowane = 1
							BEGIN
								IF @TRV_Struktura = 0
								begin
									IF @TRV_RodzajZakupu IN ( 1, 5)         
									BEGIN
										set @poleNaDekl = 23
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
										
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        									Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
									END
								end
								ELSE IF @TRV_Struktura = 2
								begin															
									IF @TRV_RodzajZakupu in (1,5)
									BEGIN                        
										set @poleNaDekl = 20
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
										
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
	        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
									END
								end
							END						  
							ELSE IF @TRV_FlagaVat &lt;&gt; 2 AND @TRV_RodzajZakupu in (1,5) 
							begin
								--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20
								set @poleNaDekl = 20
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

								--_VATQ:id = VAT7:const:KSZM
							end;              
			          
							IF @TRV_ExpoNorm IN (@e_SPR_nWewnatrzwspolnotowyVatDowolnyDTKorekta, @e_SPR_nWewnatrzwspolnotowyVat0DTKorekta) 
							begin
								IF (@TRV_RodzajZakupu IN (1, 5) AND @TRV_FlagaVat = 2) 
								begin
									--wart_DTSU = wart_DTSU + @Netto;                -- pole 21
									set @poleNaDekl = 21
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

								end
								ELSE IF @TRV_RodzajZakupu = 8 
								begin
									--wart_DTSU = wart_DTSU + @Netto;              -- pole 21
									--wart_DTSU_a = wart_DTSU_a + @Netto;              -- pole 22
									set @poleNaDekl = 21
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
									
									set @poleNaDekl = 22
						
									if @wersjaDeklaracji &gt;= 14
										set @poleNaDekl = @poleNaDekl - 10
									
									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

								end                  
							end                
						end
					end
					ELSE    
					begin      
						IF @TRV_FlagaVat = 1 AND @TRV_StawkaPod = 0 AND (@TRV_ExpoNorm = 2 OR @TRV_ExpoNorm = 4) 
						begin
							--wart_ExT = wart_ExT + @Netto;                 -- pole 32
							set @poleNaDekl = 32
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end
						ELSE IF @TRV_FlagaVat = 0 AND @TRV_StawkaPod = 0 AND (@TRV_ExpoNorm = 2 OR @TRV_ExpoNorm = 4) 
						begin
							--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20
							set @poleNaDekl = 20
						
							if @wersjaDeklaracji &gt;= 14
								set @poleNaDekl = @poleNaDekl - 10
							
							insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        						Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
							values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
								@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

						end					
						ELSE IF NOT (@TRV_FlagaVat = 1 AND @TRV_Zrodlowa &lt;&gt; 0)		-- ttt
						begin
							if @TRV_StawkaPod = 0 and @TRV_FlagaVAT = 2
							begin
								if @g_ksi_lUwzgledniajNieopodatkowane = 1
									if @TRV_Struktura = 0 
									begin
										set @poleNaDekl = 23
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
										
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        									Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
									end
									else if @TRV_Struktura = 2
									begin
										set @poleNaDekl = 20
						
										if @wersjaDeklaracji &gt;= 14
											set @poleNaDekl = @poleNaDekl - 10
										
										insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        									Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
										values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
											@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)
									end
							end
							else --*/
							if @TRV_StawkaPod = 0 and @TRV_FlagaVat = 0
							begin
								--wart_DTSU_Zw = wart_DTSU_Zw + @Netto;             -- pole 20            
								set @poleNaDekl = 20
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

							end						
							else if @TRV_StawkaPod = 0 and @TRV_FlagaVat = 1  
							begin
								--wart_DTSU_0 = wart_DTSU_0 + @Netto;              -- pole 23
								set @poleNaDekl = 23
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, 0, @TRV_VatNalOd, @NIP, @KorektaDanych)

							end
							else if (@TRV_StawkaPod = 3 or @TRV_StawkaPod = 5 ) and @TRV_FlagaVat = 1 
							begin
								--wart_DTSU_3_5_Netto = wart_DTSU_3_5_Netto + @Netto;       -- pole 25
								--wart_DTSU_3_5_Vat = wart_DTSU_3_5_Vat + @Vat;             -- pole 26
								set @poleNaDekl = 25
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)


								if @wersjaDeklaracji&gt;=21 and @TRV_GIDTyp=2033 and @TRNTyp=35
								begin
									set @poleNaDekl = 68

									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								end
							end
							else if (@TRV_StawkaPod = 7 or @TRV_StawkaPod = 8) and @TRV_FlagaVat = 1 
							begin
								--wart_DTSU_7_8_Netto = wart_DTSU_7_8_Netto + @Netto;      -- pole 27
								--wart_DTSU_7_8_Vat = wart_DTSU_7_8_Vat + @Vat;            -- pole 28
								set @poleNaDekl = 27
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)


								if @wersjaDeklaracji&gt;=21 and @TRV_GIDTyp=2033 and @TRNTyp=35
								begin
									set @poleNaDekl = 68

									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								end
							end
							else if (@TRV_StawkaPod = 22 or @TRV_StawkaPod = 23) and @TRV_FlagaVat = 1 
							begin
								--wart_DTSU_22_23_Netto = wart_DTSU_22_23_Netto + @Netto;    -- pole 29
								--wart_DTSU_22_23_Vat = wart_DTSU_22_23_Vat + @Vat;          -- pole 30
								set @poleNaDekl = 29
						
								if @wersjaDeklaracji &gt;= 14
									set @poleNaDekl = @poleNaDekl - 10
								
								insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        							Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
								values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
									@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)


								if @wersjaDeklaracji&gt;=21 and @TRV_GIDTyp=2033 and @TRNTyp=35
								begin
									set @poleNaDekl = 68

									insert #tmpWyn (GIDTyp, GIDNumer, GIDLp, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok,
        								Akronim, Nazwa,	Netto, Vat, VatNalOd, NIP, KorektaDanych)
									values (@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatNumer, @TRN_VatRejestr, @poleNaDekl, 1, @DataWyst, @DataZak, 	
										@NumerDok, @Akronim, @Nazwa, @Netto, @Vat, @TRV_VatNalOd, @NIP, @KorektaDanych)
								end
							end	
						end;
					end
				end    
		  end
		END
 		fetch next from curDok into
			@TRV_GIDTyp, @TRV_GIDNumer, @TRV_GIDLp, @TRN_VatRejestr, @TrN_VatNumer, @DataWyst, @DataZak,
			@Netto, @Vat, @TRV_StawkaPod, @TRV_FlagaVAT, @TRV_RodzajZakupu, @TRV_Struktura, @TRN_VatKorekta,
			@TRV_ExpoNorm, @TRV_Zrodlowa, @TRN_VatRok, @TRN_VatMiesiac, @TRN_RolnikRyczalt, @TRN_KorektaOdlicz, @CzySad,
			@NumerDok, @Akronim, @Nazwa, @TRV_VatNalOd, @NIP, @KorektaDanych, @TRNTyp, @TRV_ProceduraOSS
		
	end

	close curDok
	deallocate curDok

	select GIDTyp, GIDNumer, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok, Akronim, Nazwa,
		sum(case when VatNalOd &gt; 0 then 0 else Netto end) as Netto, SUM(Vat) as Vat, isnull(VatNalOd,0) VatNalOd, NIP
	from #tmpWyn
	group by GIDTyp, GIDNumer, KorektaDanych, NrWRej, Rejestr, PoleNaDekl, Odliczenie, DataWystaw, DataSprzed, NrDok, Akronim, Nazwa, VatNalOd, NIP
	order by PoleNaDekl, Odliczenie

	drop table #tmpDokumenty
	drop table #tmpWyn


	 /*
	 --   obliczenia poszczególnych pól deklaracji VAT7(12)
	-------------------------------------------------------

	declare @wart_DTSU_Zw decimal(15,2);             -- pole 20
	declare @wart_DTSU decimal(15,2);                -- pole 21
	declare @wart_DTSU_a decimal(15,2);              -- pole 22
	declare @wart_DTSU_0 decimal(15,2);              -- pole 23
	declare @wart_DTSU_0a decimal(15,2);             -- pole 24
	declare @wart_DTSU_3_5_Netto decimal(15,2);      -- pole 25
	declare @wart_DTSU_3_5_Vat decimal(15,2);        -- pole 26
	declare @wart_DTSU_7_8_Netto decimal(15,2);      -- pole 27
	declare @wart_DTSU_7_8_Vat decimal(15,2);        -- pole 28
	declare @wart_DTSU_22_23_Netto decimal(15,2);    -- pole 29
	declare @wart_DTSU_22_23_Vat decimal(15,2);      -- pole 30
	declare @wart_WWDT decimal(15,2);                -- pole 31
	declare @wart_ExT decimal(15,2);                 -- pole 32
	declare @wart_WWNT_Netto decimal(15,2);          -- pole 33
	declare @wart_WWNT_Vat decimal(15,2);            -- pole 34
	declare @wart_IT_Netto decimal(15,2);            -- pole 35
	declare @wart_IT_Vat decimal(15,2);              -- pole 36
	declare @wart_IU_Netto decimal(15,2);            -- pole 37
	declare @wart_IU_Vat decimal(15,2);              -- pole 38
	declare @wart_IU_RO_Netto decimal(15,2);         -- pole 39
	declare @wart_IU_RO_Vat decimal(15,2);           -- pole 40
	declare @wart_DTPN_Netto decimal(15,2);          -- pole 41
	declare @wart_DTPN_Vat decimal(15,2);            -- pole 42
	declare @wart_WWNST decimal(15,2);               -- pole 44
	*/
	
set nocount off	
END		

</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>