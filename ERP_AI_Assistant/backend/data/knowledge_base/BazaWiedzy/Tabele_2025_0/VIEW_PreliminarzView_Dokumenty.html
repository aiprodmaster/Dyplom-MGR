<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="PreliminarzView_Dokumenty"></A><PRE>
          <FONT SIZE="2"><I>/* PreliminarzView_Dokumenty */</I><BR>
CREATE VIEW CDN.PreliminarzView_Dokumenty (
PRLVD_GIDTYP, PRLVD_GIDNUMER, PRLVD_GIDLP
,PRLVD_DOKUMENTOBCY
,PRLVD_DATA,PRLVD_DATASPRZZAK
,PRLVD_MPP,PRLVD_KARNUMER
,PRLVD_ZAKSIEGOWANO, PRLVD_NIEKSIEGOWAC, PRLVD_DATAKSIEGOWANIA
,PRLVD_BUFOR,PRLVD_KONTOPRZEC, PRLVD_AKTYWNY
,PRLVD_LP,PRLVD_STAN,PRLVD_FISKALNY,PRLVD_KONTYP,PRLVD_TSTATUS
,PRLVD_NUMER, PRLVD_KNTTYP, PRLVD_KNTNUMER
,NUMDGIDTYP,NUMDSPITYP,NUMDTRNTYP,NUMDNUMER,NUMDROK,NUMDSERIA,NUMDMIESIAC,NUMDOKRSYMBOL
)
AS 
SELECT 
A.GIDTYP, A.GIDNUMER, A.GIDLp
,A.DOKUMENT
,A.DATA,A.DATASPRZZAK
,A.MPP,A.KARNUMER
,A.ZAKSIEGOWANO, A.NIEKSIEGOWAC, A.DATAKSIEGOWANIA
,A.BUFOR,A.KAZ_KONTOPRZEC,A.AKTYWNY
,A.LP,A.STAN,A.FISKALNY,A.KONTYP,A.TSTATUS
, A.NUMER, A.KNTTYP, A.KNTNUMER
,A.GIDTYPNAG,A.SPITYPNAG,A.TRNTYP,A.NUMER,A.ROK,A.SERIA,A.MIESIAC,A.OKRSYMBOL
FROM (
SELECT 
T1.TRN_GIDTyp GIDTYP, T1.TRN_GIDNumer GIDNUMER, 0 GIDLp
,T1.TRN_DOKUMENTOBCY DOKUMENT
,T1.TRN_DATA2 DATA,CASE WHEN NOT T1.TRN_GIDTyp IN (2000,2008,2002,2010) 
	AND NOT (--T1.TRN_GIDTyp IN (1832,1836,2041,2043,2045) AND 
	T1.TRN_GIDTyp &amp; 8&gt;0 AND T1.TrN_ZwrNumer=0) 
	AND NOT T1.TRN_TRNTyp IN (34,35) THEN 
		CASE WHEN T1.TRN_GIDTyp &amp; 8&gt;0 THEN 
			CASE WHEN T1.TrN_ZwrNumer=T1.TRN_GIDNumer THEN TRN_DataSprOrg
			ELSE
				(SELECT T2.TRN_DATA3 FROM CDN.TRANAG T2 WHERE T1.TRN_IDORG=T2.TRN_GIDNumer) 
			END
		ELSE 
			T1.TRN_DATA3 
		END 
	ELSE 0 END DATASPRZZAK
,T1.TRN_MPP MPP,T1.TRN_KARNUMER KARNUMER
,T1.TRN_TRNTYP TRNTYP,T1.TRN_TRNNUMER NUMER,T1.TRN_TRNROK ROK,T1.TRN_TRNSERIA SERIA,T1.TRN_TRNMIESIAC MIESIAC,'' OKRSYMBOL
, T1.TRN_ZAKSIEGOWANO ZAKSIEGOWANO, T1.TRN_NIEKSIEGOWAC NIEKSIEGOWAC,T1.TRN_DATAKSIEGOWANIA DATAKSIEGOWANIA, CASE WHEN T1.TRN_STAN&lt;=2 THEN 1 ELSE 0 END BUFOR
,'' KAZ_KONTOPRZEC,T1.TRN_AKTYWNY AS AKTYWNY,T1.TRN_TRNLP AS LP,T1.TRN_STAN AS STAN,T1.TRN_FISKALNY AS FISKALNY,T1.TRN_KONTYP AS KONTYP,0 AS TSTATUS
,T1.TRN_GIDTYP GIDTYPNAG, T1.TRN_SPITYP SPITYPNAG
, T1.TRN_KNTTYP KNTTYP, T1.TRN_KNTNUMER KNTNUMER
FROM CDN.TRANAG T1 
UNION ALL
SELECT 
IMN_GIDTyp, IMN_GIDNumer, 0
,IMN_DOKUMENTOBCY
,IMN_DATAWYSTAWIENIA,IMN_DataZakupu
,0,0
,0,IMN_IMNNUMER,IMN_IMNROK,IMN_IMNSERIA,IMN_IMNMIESIAC,''
, IMN_ZAKSIEGOWANO, IMN_NIEKSIEGOWAC, IMN_DATAKSIEGOWANIA, CASE WHEN IMN_STAN&lt;=2 THEN 1 ELSE 0 END
,'',IMN_AKTYWNY AS AKTYWNY,IMN_IMNLP AS LP ,IMN_STAN AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, IMN_GIDTYP, IMN_GIDTYP
, IMN_KNTTYP, IMN_KNTNUMER
FROM CDN.IMPNAG 
UNION ALL
SELECT 
MEN_GIDTyp, MEN_GIDNumer, 0
,MEN_NUMERDOKUMENTU
,MEN_DATAWPROW,MEN_DATAOPER
,0,0
,0,MEN_NUMER,(MEN_ROKMIESIAC/100),MEN_SERIA,MEN_ROKMIESIAC%100,MEN_OkrSymbol
, MEN_ZAKSIEGOWANO, MEN_NIEKSIEGOWAC, MEN_DATAKSIEGOWANIA, 0
,'',MEN_AKTYWNY AS AKTYWNY,0 AS LP,MEN_STAN AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, MEN_GIDTYP, MEN_GIDTYP
, MEN_KNTTYP, MEN_KNTNUMER
FROM CDN.MEMNAG 
	JOIN CDN.MEMDOKNAG ON MEN_MDNNUMER = MDN_GIDNUMER
WHERE MEN_GIDTYP = 4144 AND MDN_PODMIOTMIEJSCE= 1
UNION ALL
SELECT 
MEN_GIDTyp, MEN_GIDNumer, 0
,MEN_NUMERDOKUMENTU
,MEN_DATAWPROW,MEN_DATAOPER
,0,0
,0,MEN_NUMER,(MEN_ROKMIESIAC/100),MEN_SERIA,MEN_ROKMIESIAC%100,MEN_OkrSymbol
, MEN_ZAKSIEGOWANO, MEN_NIEKSIEGOWAC, MEN_DATAKSIEGOWANIA, 0
,'',MEN_AKTYWNY AS AKTYWNY,0 AS LP,MEN_STAN AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, MEN_GIDTYP, MEN_GIDTYP
, 0, 0
FROM CDN.MEMNAG 
LEFT JOIN CDN.MEMDOKNAG ON MEN_MDNNUMER = MDN_GIDNUMER
WHERE MDN_PODMIOTMIEJSCE= 2
UNION ALL
SELECT 
PIN_GIDTyp, PIN_GIDNumer, 0
,PIN_IDENTYFIKATOR
,PIN_DATA,0
,0,0
,0,PIN_NUMER,PIN_ROK,'',PIN_MIESIAC,''
, PIN_ZAKSIEGOWANO, PIN_NIEKSIEGOWAC, PIN_DATAKSIEGOWANIA, 0
,'',PIN_AKTYWNY AS AKTYWNY,0 AS LP,0 AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, PIN_GIDTYP, PIN_GIDTYP
, 0, 0
FROM CDN.PIKNAG 
UNION ALL
SELECT 
SAN_GIDTyp, SAN_GIDNumer, 0
,SAN_NUMERSAD
,SAN_DATAZGLOSZENIA,0
,0,0
,0,SAN_SANNUMER,SAN_SANROK,SAN_SANSERIA,0,''
, SAN_ZAKSIEGOWANO, SAN_NIEKSIEGOWAC, SAN_DATAKSIEGOWANIA, CASE WHEN SAN_STAN&lt;=2 THEN 1 ELSE 0 END
,'',SAN_AKTYWNY AS AKTYWNY,SAN_SANLP AS LP,SAN_STAN AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, SAN_GIDTYP, SAN_GIDTYP
, SAN_PDMTYP, SAN_PDMNUMER
FROM CDN.SADNAG 
WHERE SAN_GIDTYP = 3376
UNION ALL
SELECT 
SAN_GIDTyp, SAN_GIDNumer, 0
,SAN_NUMERSAD
,SAN_DATAZGLOSZENIA,0
,0,0
,0,SAN_SANNUMER,SAN_SANROK,SAN_SANSERIA,0,''
, SAN_ZAKSIEGOWANO, SAN_NIEKSIEGOWAC, SAN_DATAKSIEGOWANIA, CASE WHEN SAN_STAN&lt;=2 THEN 1 ELSE 0 END
,'',SAN_AKTYWNY AS AKTYWNY,SAN_SANLP AS LP,SAN_STAN AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, SAN_GIDTYP, SAN_GIDTYP
, SAN_KNTTYP, SAN_KNTNUMER
FROM CDN.SADNAG 
WHERE SAN_GIDTYP &lt;&gt; 3376
UNION ALL
SELECT
UPN_GIDTyp, UPN_GIDNumer, 0
,''
,UPN_DATAUP,0
,0,UPN_KaRNumer
,0,UPN_NUMER,UPN_ROK,UPN_SERIA,0,''
, UPN_ZAKSIEGOWANO, UPN_NIEKSIEGOWAC, UPN_DATAKSIEGOWANIA, 0
,'',0 AS AKTYWNY,0 AS LP,0 AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, UPN_GIDTYP, UPN_GIDTYP
, UPN_KNTTYP, UPN_KNTNUMER
FROM CDN.UPONAG 
UNION ALL
SELECT 
PON_GIDTyp, PON_GIDNumer, 0
,CASE WHEN PON_TypPodatku=850 THEN PON_UNROSS ELSE '' END

,CASE WHEN (PON_GIDTyp = 7691 AND PON_Kwartal=1) OR PON_TypPodatku IN (15, 16,  11, 14,  24, 25)	-- definiowalne i PON_Kwartal=1  lub  kwartalne: VAT7K, VAT7D,  VATUE, VATUEK,  VAT27, VAT27K
 THEN datediff(dd,'18001228',dateadd(dd,-1,dateadd(mm,1,cdn.ymd(PON_Rok,(PON_Miesiac*3),1)))) ELSE datediff(dd,'18001228',dateadd(dd,-1,dateadd(mm,1,cdn.ymd(PON_Rok,PON_Miesiac,1)))) END
,0
,0,0
,CASE WHEN PON_TYPPODATKU=606 THEN PON_PARAML1 ELSE PON_TYPPODATKU END,PON_NUMER,PON_ROK,SUBSTRING(CAST(PON_IDENTYFIKATOR AS VARCHAR(8)),1,CASE WHEN PON_IDENTYFIKATOR&gt;=10000000 THEN 2 ELSE 1 END),PON_MIESIAC,PON_OkrSymbol
,PON_ZAKSIEGOWANO, PON_NIEKSIEGOWAC, PON_DATAKSIEGOWANIA, CASE WHEN PON_STATUS = 0 AND PON_GIDTYP NOT IN(6272,6400) THEN 1 ELSE 0 END
,'',PON_Aktywny AS AKTYWNY,0 AS LP,0 AS STAN,0 AS FISKALNY,0 AS KONTYP,PON_STATUS AS TSTATUS
, PON_GIDTYP, PON_DPNID
, 0, 0
FROM CDN.PODNAG 
UNION ALL
SELECT 
PRL_GIDTyp, PRL_GIDNumer, 0
,PRL_DOKUMENTOBCY
,PRL_DATAWYST,0
,0,0
,0,PRL_NUMER,PRL_ROK,PRL_SERIA,0,''
, 0, 0, 0, 0
,'',0 AS AKTYWNY,0 AS LP,0 AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, PRL_GIDTYP, PRL_GIDTYP
, PRL_KNTTYP, PRL_KNTNUMER
FROM 
CDN.PRELIMINARZ 
UNION ALL
SELECT
KRP_GIDTyp, KRP_GIDNumer, 0
,''
,KRP_DATAZAMKNIECIA,0
,0,0
,0,KRP_NUMER,KRP_ROK,KRP_SERIA,0,''
, KRP_ZAKSIEGOWANO, KRP_NIEKSIEGOWAC, KRP_DATAKSIEGOWANIA, 0
,'',0 AS AKTYWNY,0 AS LP,0 AS STAN,0 AS FISKALNY,0 AS KONTYP, 0 AS TSTATUS
, KRP_GIDTYP, KRP_GIDTYP
, 0, 0
FROM CDN.RAPORTY 
UNION ALL
SELECT
DLG_GIDTyp, DLG_GIDNumer, 0
,''
,DLG_TSTAMPAKCEPTWPR,0
,0,0
,0,DLG_NUMER,DLG_ROK,DLG_SERIA,0,''
, DLG_ZAKSIEGOWANO, DLG_NIEKSIEGOWAC, DLG_DATAKSIEGOWANIA, 0
,'',0 AS AKTYWNY,0 AS LP,0 AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, DLG_GIDTYP, DLG_GIDTYP
, 0, 0
FROM CDN.DELEGACJE 
UNION ALL
SELECT 
4608, KBNN_ID, 0
,''
,DATEDIFF(DD,'18001228',CDN.TSTODATE(KBNN_DATAWYSTAWIENIA, 1)),0
,0,KBNN_KarNumer
,0,KBNN_NUMER,KBNN_ROK,KBNN_SERIA,0,''
, KBNN_ZAKSIEGOWANO, KBNN_NIEKSIEGOWAC, KBNN_DATAKSIEGOWANIA, 0
,'',KBNN_AKTYWNY AS AKTYWNY,0 AS LP,KBNN_STAN AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, 4608, 4608
, 0, 0
FROM CDN.KBNNAG 
UNION ALL
SELECT 
PRLN_PRLNTYP, PRLN_ID, 0
,PRLN_DokumentObcy
,PRLN_DATA,0
,0,PRLN_KarNumer
,0,PRLN_NUMER,PRLN_ROK,PRLN_SERIA,0,''
, PRLN_ZAKSIEGOWANO, PRLN_NIEKSIEGOWAC, PRLN_DATAKSIEGOWANIA, 0
,'',PRLN_AKTYWNY AS AKTYWNY,0 AS LP,PRLN_STATUS AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, PRLN_PRLNTYP, PRLN_PRLNTYP
, 0, 0
FROM 
CDN.PROLONGNAG 
UNION ALL
SELECT 
434, KMN_ID, 0
,KMN_NumerDokumentu
,KMN_DataDokumentu,0
,0,0
,0,KMN_Numer,KMN_Rok,KMN_Seria,0,''
, KMN_ZAKSIEGOWANO, KMN_NIEKSIEGOWAC, KMN_DATAKSIEGOWANIA, CASE WHEN KMN_Status=0 THEN 1 ELSE 0 END
,'',KMN_AKTYWNY AS AKTYWNY,0 AS LP,KMN_STATUS AS STAN,0 AS FISKALNY,0 AS KONTYP,0 AS TSTATUS
, 434, 434
, 0, 0
FROM 
CDN.KompNag 
) A

</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>