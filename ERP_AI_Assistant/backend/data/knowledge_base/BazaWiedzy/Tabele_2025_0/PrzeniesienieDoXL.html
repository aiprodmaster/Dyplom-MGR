<HTML>
  <HEAD>
    <META http-equiv="Content-Type" content="text/html; charset=utf-8">
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1250">
    <META NAME="Author" CONTENT="Comarch S.A.">
    <LINK rel="stylesheet" type="text/css" href="Style/doc.css">
    <TITLE>Skrypt SQL</TITLE>
  </HEAD>
  <BODY>
<DIV CLASS="TextInfo">
      <P><A name="PrzeniesienieDoXL"></A><PRE>
          <FONT SIZE="2"><I>/* PrzeniesienieDoXL */</I><BR>
CREATE PROCEDURE CDN.PrzeniesienieDoXL
@MyGUID UNIQUEIDENTIFIER,
@WykonajOpis TINYINT
AS
BEGIN
	
	DECLARE @MaxDwkId INT
	DECLARE @MaxDwpId INT
	DECLARE @czyBylaKwota INT

	DECLARE @DTT_ID			INTEGER  
	DECLARE @DTT_GUID		UNIQUEIDENTIFIER
	DECLARE @DTT_ProgramID		SMALLINT
	DECLARE @DTT_ListaID		INTEGER
	DECLARE @DTT_WyplataID		INTEGER
	DECLARE @DTT_TStamp		INTEGER		
	DECLARE @DTT_Rok		INTEGER
	DECLARE @DTT_Miesiac		SMALLINT
	DECLARE @DTT_Data		INTEGER
	DECLARE @DTT_DataWyst		INTEGER
	DECLARE @DTT_XL		SMALLINT
	DECLARE @DTT_Nazwa		VARCHAR(40)
	DECLARE @DTT_Opis		VARCHAR(40)
	DECLARE @DTT_Znacznik		VARCHAR(1)
	DECLARE @DTT_Kod		VARCHAR(30)
	DECLARE @DTT_Imie		VARCHAR(30)
	DECLARE @DTT_Nazwisko		VARCHAR(80)
	DECLARE @DTT_KodDzialu		VARCHAR(40)
	DECLARE @DTT_DzlId		INTEGER
	DECLARE @DTT_DzlKod		VARCHAR(255)
	DECLARE @DTT_Rodzaj		SMALLINT
	DECLARE @DTT_RodzajFIS		SMALLINT
	DECLARE @DTT_KosztFirma		SMALLINT
	DECLARE @DTT_UBZTyuId		INT
	DECLARE @DTT_Kategoria		SMALLINT
	DECLARE @DTT_Brutto 		DECIMAL(15,2)
	DECLARE @DTT_Zaliczka		DECIMAL(15,2)
	DECLARE @DTT_Zdrowotne		DECIMAL(15,2)
	DECLARE @DTT_EmerytalneP	DECIMAL(15,2)
	DECLARE @DTT_EmerytalneF	DECIMAL(15,2)
	DECLARE @DTT_RentoweP		DECIMAL(15,2)
	DECLARE @DTT_RentoweF		DECIMAL(15,2)
	DECLARE @DTT_Chorobowe	DECIMAL(15,2)
	DECLARE @DTT_Wypadkowe	DECIMAL(15,2)
	DECLARE @DTT_Netto 		DECIMAL(15,2)
	DECLARE @DTT_FunduszPracy	DECIMAL(15,2)
	DECLARE @DTT_FGSP 		DECIMAL(15,2)
	DECLARE @DTT_FEP        DECIMAL(15,2)
	DECLARE @DTT_LpTryb		SMALLINT
	DECLARE @DTT_LpParentID	INTEGER
	DECLARE @DTT_WypTryb		SMALLINT
	DECLARE @DTT_WypParentID	INTEGER

	--dolozone dla list walutowych 
    DECLARE @DTT_Oddelegowani SMALLINT
    DECLARE @DTT_LPLWaluta VARCHAR(3)
    DECLARE @DTT_LPLKursL DECIMAL(15,4)
    DECLARE @DTT_LPLKursM DECIMAL(5,0)
	DECLARE @DTT_TWPStandardowy SMALLINT
	DECLARE @DTT_WPEWartoscWal DECIMAL(15,2)

	--Do obslugi PPK
	DECLARE @DTT_PPKPrcPodst	DECIMAL(15,2)	--Składki PPK pracownika podstawowe		kat 15
	DECLARE @DTT_PPKPrcDod		DECIMAL(15,2)	--Składki PPK pracownika dodatkowe		kat 16
	DECLARE @DTT_PPKFirPodst	DECIMAL(15,2)	--Składki PPK firmy podstawowe			kat 17
	DECLARE @DTT_PPKFirDod		DECIMAL(15,2)	--Składki PPK firmy dodatkowe			kat 18
	
	--Pobranie max(DWK_ID)
	select @MaxDwkId = isnull(max(DWK_ID),0) from cdn.dtsWyplatyKwoty
	--Pobranie max(DWp_ID)
	select @MaxDwpId = isnull(max(DWp_ID),0) from cdn.dtsWyplaty
	
	DECLARE CursorForDWP CURSOR LOCAL FAST_FORWARD READ_ONLY FOR 
	SELECT 	DTT_ID, 
			DTT_GUID,
			DTT_ProgramID, 
			DTT_ListaID	,
			DTT_WyplataID,
			DTT_TStamp	,			
			DTT_Rok	,
			DTT_Miesiac	,
			DTT_Data,
			DTT_DataWyst,
			DTT_XL	,
			DTT_Nazwa,
			DTT_Opis,
			DTT_Znacznik,
			DTT_Kod	,
			DTT_Imie,
			DTT_Nazwisko,
			DTT_KodDzialu,
			DTT_DzlId	,
			DTT_DzlKod	,
			DTT_Rodzaj	,
			DTT_RodzajFIS	,
			DTT_KosztFirma	,
			DTT_UBZTyuId	,
			DTT_Kategoria	,
			DTT_Brutto 		,
			DTT_Zaliczka	,
			DTT_Zdrowotne	,
			DTT_EmerytalneP	,
			DTT_EmerytalneF	,
			DTT_RentoweP	,
			DTT_RentoweF	,
			DTT_Chorobowe	,
			DTT_Wypadkowe	,
			DTT_Netto 		,
			DTT_FunduszPracy,
			DTT_FGSP 		,
			DTT_FEP         ,
			DTT_LpTryb		,
			DTT_LpParentID	,
			DTT_WypTryb		,
			DTT_WypParentID ,
			DTT_Oddelegowani,
			DTT_LPLWaluta      ,
			DTT_LPLKursL       ,
			DTT_LPLKursM       ,
			DTT_TWPStandardowy ,
			DTT_BruttoWal,
			DTT_PPKPrcPodst,
			DTT_PPKPrcDod,	
			DTT_PPKFirPodst,
			DTT_PPKFirDod
			FROM CDN.##DtsTempOptima where DTT_GUID=@MyGUID

	OPEN CursorForDWP
    WHILE 1=1 
    BEGIN						   
       FETCH NEXT FROM CursorForDWP INTO
									@DTT_ID, 
									@DTT_GUID,
									@DTT_ProgramID, 
									@DTT_ListaID	,
									@DTT_WyplataID,
									@DTT_TStamp	,			
									@DTT_Rok	,
									@DTT_Miesiac	,
									@DTT_Data,
									@DTT_DataWyst,
									@DTT_XL	,
									@DTT_Nazwa,
									@DTT_Opis,
									@DTT_Znacznik,
									@DTT_Kod	,
									@DTT_Imie,
									@DTT_Nazwisko,
									@DTT_KodDzialu,
									@DTT_DzlId	,
									@DTT_DzlKod	,
									@DTT_Rodzaj	,
									@DTT_RodzajFIS	,
									@DTT_KosztFirma	,
									@DTT_UBZTyuId	,
									@DTT_Kategoria	,
									@DTT_Brutto 	,
									@DTT_Zaliczka	,
									@DTT_Zdrowotne	,
									@DTT_EmerytalneP,
									@DTT_EmerytalneF,
									@DTT_RentoweP	,
									@DTT_RentoweF	,
									@DTT_Chorobowe	,
									@DTT_Wypadkowe	,
									@DTT_Netto 		,
									@DTT_FunduszPracy,
									@DTT_FGSP 		,
									@DTT_FEP        ,
									@DTT_LpTryb		,
									@DTT_LpParentID	,
									@DTT_WypTryb	,
									@DTT_WypParentID,
									@DTT_Oddelegowani,
									@DTT_LPLWaluta   ,
									@DTT_LPLKursL    ,
									@DTT_LPLKursM    ,
									@DTT_TWPStandardowy,
		                            @DTT_WPEWartoscWal,
									@DTT_PPKPrcPodst,
									@DTT_PPKPrcDod,	
									@DTT_PPKFirPodst,
									@DTT_PPKFirDod	
		 IF @@FETCH_STATUS &lt;&gt; 0 
				 BREAK 

		SET @czyBylaKwota = 0
		--Dodanie rekordu "F" do tabeli cdn.DtsWyplaty
		SET @MaxDWpID = @MaxDWpID + 1	

		INSERT INTO [CDN].[DtsWyplaty]
           ([DWp_ID]
           ,[DWp_ProgramID]
           ,[DWp_ListaID]
           ,[DWp_XL]
           ,[DWp_TStamp]
           ,[DWp_Rok]
           ,[DWp_Miesiac]
           ,[DWp_Nazwa]
           ,[DWp_Opis]
           ,[DWp_Znacznik]
           ,[DWp_Kod]
           ,[DWp_Imie]
           ,[DWp_Nazwisko]
           ,[DWp_Data]
           ,[DWp_DataWyst]
           ,[DWp_DzlId]
           ,[DWp_DzlKod]
           ,[DWp_Kategoria]
           ,[DWp_LpTryb]
           ,[DWp_LpParentID]
           ,[DWp_WypTryb]
           ,[DWp_WypParentID]
           ,[dwp_Oddelegowani]
           ,[dwp_Waluta]
           ,[dwp_KursL]
           ,[dwp_KursM]
           )
		VALUES
           (@MaxDWpID
           ,@DTT_ProgramID
           ,@DTT_ListaID
           ,@DTT_XL
           ,@DTT_TStamp
           ,@DTT_Rok
           ,@DTT_Miesiac
           ,@DTT_Nazwa
           ,@DTT_Opis
           ,'F'
           ,''
           ,''
           ,''
           ,@DTT_Data
           ,@DTT_DataWyst
           ,0
           ,''
           ,@DTT_Kategoria
           ,@DTT_LpTryb
           ,@DTT_LpParentID
           ,@DTT_WypTryb
           ,@DTT_WypParentID	
           ,@DTT_Oddelegowani
           ,@DTT_LPLWaluta
           ,@DTT_LPLKursL
           ,@DTT_LPLKursM           
           )
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('201:Błąd dodawania rekordu: %s  do CDN.DtsWyplaty. ', 16, 1,@DTT_Nazwa) 
				--RETURN 201
			END
		--przenoszenie opisu analitycznego
		IF @WykonajOpis = 1
		BEGIN
			INSERT INTO CDN.[DtsWyplatyOpis]
				(DWO_DwpId,
				 DWO_LokId, 
				 DWO_LokKod,
				 DWO_DzlId,
				 DWO_DzlKod,
				 DWO_PrjId,
				 DWO_PrjKod,
				 DWO_Procent,
				 DWO_Brutto,
				 DWO_Netto,
				 DWO_ZUSF,
				 DWO_ZUSP,
				 DWO_Zdrow,
				 DWO_ZalFIS,
				 DWO_PPKP,
				 DWO_PPKF) 
				SELECT @MaxDWpID,
					   DTO_LokId,
					   DTO_LokKod,
					   DTO_DzlId,
					   DTO_DzlKod,
					   DTO_PrjId,
					   DTO_PrjKod,
					   DTO_Procent,
					   DTO_Brutto,
					   DTO_Netto,
					   DTO_ZUSF,
					   DTO_ZUSP,
					   DTO_Zdrow,
					   DTO_ZalFIS,
					   DTO_SklPPKPrc,
					   DTO_SklPPKFirma FROM CDN.##DtsTempOptimaOpis 
								  WHERE DTO_LplId = @DTT_ListaID AND DTO_WpeId = @DTT_WyplataID AND DTO_GUID=@MyGUID
		END
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('202:Błąd dodawania rekordu do DtsWyplatyOpis. ', 16, 1) 
				--RETURN 202
			END
		--Dodawanie kwot	
		--Kwota brutto
		IF ROUND(@DTT_Brutto,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,1
				,@DTT_Brutto
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('203:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty brutto. ', 16, 1) 
				--RETURN 203
			END
		END 

		--Zaliczka podatku
		IF ROUND(@DTT_Zaliczka,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,2
				,@DTT_Zaliczka
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('204:Błąd dodawania rekordu do DtsWyplatyKwoty dla zaliczki podatku. ', 16, 1) 
				--RETURN 204
			END
		END 


		--Zdrowotne
		IF ROUND(@DTT_Zdrowotne,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,3
				,@DTT_Zdrowotne
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('205:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty zdrowotne. ', 16, 1) 
				--RETURN 205
			END			
		END 

		--Emerytalne pracownika
		IF ROUND(@DTT_EmerytalneP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,4
				,@DTT_EmerytalneP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('206:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty emerytalne pracownika. ', 16, 1) 
				--RETURN 206
			END	
		END 

		--Emerytalne firmy
		IF ROUND(@DTT_EmerytalneF,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,5
				,@DTT_EmerytalneF
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('207:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty emerytalne firmy. ', 16, 1) 
				--RETURN 207
			END	
		END

		--Rentowe pracownika
		IF ROUND(@DTT_RentoweP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,6
				,@DTT_RentoweP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('208:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty rentowe pracownika. ', 16, 1) 
				--RETURN 208
			END	
		END

		--Rentowe firmy
		IF ROUND(@DTT_RentoweF,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,7
				,@DTT_RentoweF
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('209:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty rentowe firmy. ', 16, 1) 
				--RETURN 209
			END	
		END

		--Chorobowe
		IF ROUND(@DTT_Chorobowe,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,8
				,@DTT_Chorobowe
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('210:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty chorobowe. ', 16, 1) 
				--RETURN 210
			END	
		END

		--Wypadkowe
		IF ROUND(@DTT_Wypadkowe,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,9
				,@DTT_Wypadkowe
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('211:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty wypadkowe. ', 16, 1) 
				--RETURN 211
			END	
		END

		--Netto, dodajemy zawsze nawet gdy = 0
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,10
				,@DTT_Netto
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('212:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty netto. ', 16, 1) 
				--RETURN 212
			END	
		--Fundusz Pracy
		IF ROUND(@DTT_FunduszPracy,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,11
				,@DTT_FunduszPracy
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('213:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty fundusz pracy. ', 16, 1) 
				--RETURN 213
			END	
		END
		--FGŚP
		IF ROUND(@DTT_FGSP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,12
				,@DTT_FGSP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('214:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty FGŚP. ', 16, 1) 
				--RETURN 214
			END	
		END
        --FEP
        IF ROUND(@DTT_FEP,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,13
                        ,@DTT_FEP
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty FEP. ', 16, 1)
                        --RETURN 215
                END
        END

        --nowa wartosc pola  DWK_Kategoria = 14 - tylko dla list walutowych
        IF ROUND(@DTT_WPEWartoscWal,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,14
                        ,@DTT_WPEWartoscWal
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty brutto w walucie obcej. ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 15 - PPK Składka podstawowa pracownika
        IF ROUND(@DTT_PPKPrcPodst,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,15
                        ,@DTT_PPKPrcPodst
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK - Składka podstawowa pracownika ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 16 - PPK Składka dodatkowa pracownika
        IF ROUND(@DTT_PPKPrcDod,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,16
                        ,@DTT_PPKPrcDod
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK - Składka dodatkowa pracownika ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 17 - PPK Składka podstawowa pracodawcy
        IF ROUND(@DTT_PPKFirPodst,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,17
                        ,@DTT_PPKFirPodst
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK Składka podstawowa pracodawcy ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 18 - PPK Składka dodatkowa pracodawcy
        IF ROUND(@DTT_PPKFirDod,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,18
                        ,@DTT_PPKFirDod
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK Składka dodatkowa pracodawcy ', 16, 1)
                        --RETURN 215
                END
        END

	 --Dodanie rekordu "P" do tabeli cdn.DtsWyplaty
		SET @MaxDWpID = @MaxDWpID+1
		INSERT INTO [CDN].[DtsWyplaty]
           ([DWp_ID]
           ,[DWp_ProgramID]
           ,[DWp_ListaID]
           ,[DWp_XL]
           ,[DWp_TStamp]
           ,[DWp_Rok]
           ,[DWp_Miesiac]
           ,[DWp_Nazwa]
           ,[DWp_Opis]
           ,[DWp_Znacznik]
           ,[DWp_Kod]
           ,[DWp_Imie]
           ,[DWp_Nazwisko]
           ,[DWp_Data]
           ,[DWp_DataWyst]
           ,[DWp_DzlId]
           ,[DWp_DzlKod]
           ,[DWp_Kategoria]
           ,[DWp_LpTryb]
           ,[DWp_LpParentID]
           ,[DWp_WypTryb]
	      ,[DWp_WypParentID]
	      ,[dwp_Oddelegowani]
           ,[dwp_Waluta]
           ,[dwp_KursL]
           ,[dwp_KursM]
	      )
		 VALUES
           (@MaxDWpID
           ,@DTT_ProgramID
           ,@DTT_ListaID
           ,@DTT_XL
           ,@DTT_TStamp
           ,@DTT_Rok
           ,@DTT_Miesiac
           ,@DTT_Nazwa
           ,@DTT_Opis
           ,@DTT_Znacznik
           ,@DTT_Kod
           ,@DTT_Imie
           ,@DTT_Nazwisko
           ,@DTT_Data
           ,@DTT_DataWyst
           ,@DTT_DzlId
           ,@DTT_DzlKod
           ,@DTT_Kategoria
           ,@DTT_LpTryb
           ,@DTT_LpParentID
           ,@DTT_WypTryb --
           ,@DTT_WypParentID
           ,@DTT_Oddelegowani
           ,@DTT_LPLWaluta
           ,@DTT_LPLKursL
           ,@DTT_LPLKursM    
           )
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('301:Błąd dodawania rekordu a)nazwa: %s ,b)kod: %s , c)imię %s , c)nazwisko: %s do CDN.DtsWyplaty. ', 16, 1,@DTT_Nazwa,@DTT_Kod,@DTT_Imie,@DTT_Nazwisko) 
				--RETURN 301
			END
		--przenoszenie opisu analitycznego
		IF @WykonajOpis = 1
		BEGIN
			  INSERT INTO CDN.DtsWyplatyOpis
				(DWO_DwpId, 
				 DWO_LokId, 
				 DWO_LokKod,
				 DWO_DzlId,
				 DWO_DzlKod,
				 DWO_PrjId,
				 DWO_PrjKod,
				 DWO_Procent,
				 DWO_Brutto,
				 DWO_Netto,
				 DWO_ZUSF,
			     DWO_ZUSP,
				 DWO_Zdrow,
				 DWO_ZalFIS,
				 DWO_PPKP,
				 DWO_PPKF)
				 SELECT @MaxDWpID,
						DTO_LokId,
						DTO_LokKod,
						DTO_DzlId,
						DTO_DzlKod,
						DTO_PrjId,
						DTO_PrjKod,
						DTO_Procent,
						DTO_Brutto,
						DTO_Netto,
						DTO_ZUSF,
						DTO_ZUSP,
						DTO_Zdrow,
						DTO_ZalFIS,
					    DTO_SklPPKPrc,
					    DTO_SklPPKFirma FROM CDN.##DtsTempOptimaOpis
								WHERE DTO_LplId = @DTT_ListaID AND DTO_WpeId = @DTT_WyplataID AND DTO_GUID=@MyGUID

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('302:Błąd dodawania rekordu do DtsWyplatyOpis. ', 16, 1) 
				--RETURN 302
			END
		END

		--Dodawanie kwot	
		--Kwota brutto
		IF ROUND(@DTT_Brutto,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,1
				,@DTT_Brutto
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('303:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty brutto. ', 16, 1) 
				--RETURN 303
			END
		END 

		--Zaliczka podatku
		IF ROUND(@DTT_Zaliczka,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,2
				,@DTT_Zaliczka
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('304:Błąd dodawania rekordu do DtsWyplatyKwoty dla zaliczki podatku. ', 16, 1) 
				--RETURN 304
			END
		END 


		--Zdrowotne
		IF ROUND(@DTT_Zdrowotne,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,3
				,@DTT_Zdrowotne
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)


			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('305:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty zdrowotne. ', 16, 1) 
				--RETURN 305
			END
		END 

		--Emerytalne pracownika
		IF ROUND(@DTT_EmerytalneP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,4
				,@DTT_EmerytalneP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('306:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty emerytalne pracownika. ', 16, 1) 
				--RETURN 306
			END
		END 

		--Emerytalne firmy
		IF ROUND(@DTT_EmerytalneF,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,5
				,@DTT_EmerytalneF
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('307:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty emerytalne firmy. ', 16, 1) 
				--RETURN 307
			END	
		END

		--Rentowe pracownika
		IF ROUND(@DTT_RentoweP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,6
				,@DTT_RentoweP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('308:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty rentowe pracownika. ', 16, 1) 
				--RETURN 308
			END
		END

		--Rentowe firmy
		IF ROUND(@DTT_RentoweF,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,7
				,@DTT_RentoweF
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('309:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty rentowe firmy. ', 16, 1) 
				--RETURN 309
			END	
		END

		--Chorobowe
		IF ROUND(@DTT_Chorobowe,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,8
				,@DTT_Chorobowe
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('310:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty chorobowe. ', 16, 1) 
				--RETURN 310
			END
		END

		--Wypadkowe
		IF ROUND(@DTT_Wypadkowe,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,9
				,@DTT_Wypadkowe
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('311:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty wypadkowe. ', 16, 1) 
				--RETURN 311
			END
		END

		--Netto, dodajemy zawsze nawet gdy = 0
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,10
				,@DTT_Netto
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('312:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty netto. ', 16, 1) 
				--RETURN 312
			END
		--Fundusz Pracy
		IF ROUND(@DTT_FunduszPracy,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,11
				,@DTT_FunduszPracy
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)


			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('313:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty fundusz pracy. ', 16, 1) 
				--RETURN 313
			END	
		END
		--FGŚP
		IF ROUND(@DTT_FGSP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,12
				,@DTT_FGSP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('314:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty FGŚP. ', 16, 1) 
				--RETURN 314
			END
		END
        --FEP
        IF ROUND(@DTT_FEP,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,13
                        ,@DTT_FEP
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)

                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('315:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty FEP. ', 16, 1)
                        --RETURN 315
                END
        END

        --nowa wartosc pola  DWK_Kategoria = 14 - tylko dla list walutowych
        IF ROUND(@DTT_WPEWartoscWal,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,14
                        ,@DTT_WPEWartoscWal
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty brutto w walucie obcej. ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 15 - PPK Składka podstawowa pracownika
        IF ROUND(@DTT_PPKPrcPodst,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,15
                        ,@DTT_PPKPrcPodst
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK - Składka podstawowa pracownika ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 16 - PPK Składka dodatkowa pracownika
        IF ROUND(@DTT_PPKPrcDod,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,16
                        ,@DTT_PPKPrcDod
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK - Składka dodatkowa pracownika ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 17 - PPK Składka podstawowa pracodawcy
        IF ROUND(@DTT_PPKFirPodst,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,17
                        ,@DTT_PPKFirPodst
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK Składka podstawowa pracodawcy ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 18 - PPK Składka dodatkowa pracodawcy
        IF ROUND(@DTT_PPKFirDod,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,18
                        ,@DTT_PPKFirDod
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK Składka dodatkowa pracodawcy ', 16, 1)
                        --RETURN 215
                END
        END

	--Dodanie rekordu "D" do tabeli cdn.DtsWyplaty
	SET @MaxDWpID = @MaxDWpID+1
	INSERT INTO [CDN].[DtsWyplaty]
           ([DWp_ID]
           ,[DWp_ProgramID]
           ,[DWp_ListaID]
           ,[DWp_XL]
           ,[DWp_TStamp]
           ,[DWp_Rok]
           ,[DWp_Miesiac]
           ,[DWp_Nazwa]
           ,[DWp_Opis]
           ,[DWp_Znacznik]
           ,[DWp_Kod]
           ,[DWp_Imie]
           ,[DWp_Nazwisko]
           ,[DWp_Data]
           ,[DWp_DataWyst]
           ,[DWp_DzlId]
           ,[DWp_DzlKod]
           ,[DWp_Kategoria]
           ,[DWp_LpTryb]
           ,[DWp_LpParentID]
           ,[DWp_WypTryb]
           ,[DWp_WypParentID]
           ,[dwp_Oddelegowani]
           ,[dwp_Waluta]
           ,[dwp_KursL]
           ,[dwp_KursM]
           )
     VALUES
           (@MaxDWpID
           ,@DTT_ProgramID
           ,@DTT_ListaID
           ,@DTT_XL
           ,@DTT_TStamp
           ,@DTT_Rok
           ,@DTT_Miesiac
           ,@DTT_Nazwa
           ,@DTT_Opis
           ,'D'
           ,@DTT_KodDzialu
           ,''
           ,''
           ,@DTT_Data
           ,@DTT_DataWyst
           ,@DTT_DzlId
           ,@DTT_DzlKod
           ,@DTT_Kategoria
           ,@DTT_LpTryb
           ,@DTT_LpParentID
           ,@DTT_WypTryb
           ,@DTT_WypParentID
           ,@DTT_Oddelegowani
           ,@DTT_LPLWaluta
           ,@DTT_LPLKursL
           ,@DTT_LPLKursM    
           )
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('401:Błąd dodawania rekordu: a)nazwa: %s ,b)kod działu %s do CDN.DtsWyplaty. ', 16, 1,@DTT_Nazwa,@DTT_KodDzialu) 
				--RETURN 401
			END
		--przenoszenie opisu analitycznego
		IF @WykonajOpis = 1
		BEGIN
			INSERT INTO CDN.DtsWyplatyOpis
					(DWO_DwpId,
					 DWO_LokId,
					 DWO_LokKod,
					 DWO_DzlId,
					 DWO_DzlKod,
					 DWO_PrjId,
					 DWO_PrjKod,
					 DWO_Procent,
					 DWO_Brutto,
					 DWO_Netto,
					 DWO_ZUSF,
					 DWO_ZUSP,
					 DWO_Zdrow,
					 DWO_ZalFIS,
				 DWO_PPKP,
				 DWO_PPKF)
				     SELECT @MaxDWpID,DTO_LokId,DTO_LokKod,DTO_DzlId,DTO_DzlKod,DTO_PrjId,DTO_PrjKod,DTO_Procent,DTO_Brutto,DTO_Netto,DTO_ZUSF,DTO_ZUSP,DTO_Zdrow,DTO_ZalFIS,
					   DTO_SklPPKPrc, DTO_SklPPKFirma FROM CDN.##DtsTempOptimaOpis 
				   		WHERE DTO_LplId = @DTT_ListaID AND DTO_WpeId = @DTT_WyplataID AND DTO_GUID=@MyGUID

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('402:Błąd dodawania rekordu do DtsWyplatyOpis. ', 16, 1) 
				--RETURN 402
			END
		END

		--Dodawanie kwot	
		--Kwota brutto
		IF ROUND(@DTT_Brutto,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,1
				,@DTT_Brutto
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('403:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty brutto. ', 16, 1) 
				--RETURN 403
			END
		END 

		--Zaliczka podatku
		IF ROUND(@DTT_Zaliczka,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,2
				,@DTT_Zaliczka
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('404:Błąd dodawania rekordu do DtsWyplatyKwoty dla zaliczki podatku. ', 16, 1) 
				--RETURN 404
			END
		END 


		--Zdrowotne
		IF ROUND(@DTT_Zdrowotne,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,3
				,@DTT_Zdrowotne
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('405:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty zdrowotne. ', 16, 1) 
				--RETURN 405
			END
		END 

		--Emerytalne pracownika
		IF ROUND(@DTT_EmerytalneP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,4
				,@DTT_EmerytalneP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('406:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty emerytalne pracownika. ', 16, 1) 
				--RETURN 406
			END
		END 

		--Emerytalne firmy
		IF ROUND(@DTT_EmerytalneF,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,5
				,@DTT_EmerytalneF
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('407:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty emerytalne firmy. ', 16, 1) 
				--RETURN 407
			END
		END

		--Rentowe pracownika
		IF ROUND(@DTT_RentoweP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,6
				,@DTT_RentoweP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('408:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty rentowe pracownika. ', 16, 1) 
				--RETURN 408
			END
		END

		--Rentowe firmy
		IF ROUND(@DTT_RentoweF,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,7
				,@DTT_RentoweF
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('409:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty rentowe firmy. ', 16, 1) 
				--RETURN 409
			END	
		END

		--Chorobowe
		IF ROUND(@DTT_Chorobowe,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,8
				,@DTT_Chorobowe
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('410:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty chorobowe. ', 16, 1) 
				--RETURN 410
			END
		END

		--Wypadkowe
		IF ROUND(@DTT_Wypadkowe,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,9
				,@DTT_Wypadkowe
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('411:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty wypadkowe. ', 16, 1) 
				--RETURN 411
			END	

		END

		--Netto, dodajemy zawsze nawet gdy = 0
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,10
				,@DTT_Netto
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('412:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty netto. ', 16, 1) 
				--RETURN 412
			END

		--Fundusz Pracy
		IF ROUND(@DTT_FunduszPracy,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,11
				,@DTT_FunduszPracy
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)

			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('413:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty fundusz pracy. ', 16, 1) 
				--RETURN 413
			END	
		END
		--FGŚP
		IF ROUND(@DTT_FGSP,2) &lt;&gt; 0
		BEGIN
			SET @czyBylaKwota = @czyBylaKwota + 1
			SET @MaxDwkID = @MaxDwkID + 1	
			INSERT INTO  [CDN].[DtsWyplatyKwoty]
				([DWK_ID]
				,[DWK_DwpID]
				,[DWK_Rodzaj]
				,[DWK_Kategoria]
				,[DWK_Kwota]
				,[DWK_RodzajFIS]
				,[DWK_KosztFirma]
				,[DWK_UBZTyuId])
			  VALUES
				(@MaxDwkID
				,@MaxDwpID
				,@DTT_Rodzaj
				,12
				,@DTT_FGSP
				,@DTT_RodzajFIS
				,@DTT_KosztFirma
				,@DTT_UBZTyuId)
			IF @@ERROR &lt;&gt; 0
			BEGIN
				--SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
				RAISERROR('414:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty FGŚP. ', 16, 1) 
				--RETURN 414
			END	
		END
        --FEP
        IF ROUND(@DTT_FEP,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,13
                        ,@DTT_FEP
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('415:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty FEP. ', 16, 1)
                        --RETURN 415
                END
        END

        --nowa wartosc pola  DWK_Kategoria = 14 - tylko dla list walutowych
        IF ROUND(@DTT_WPEWartoscWal,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,14
                        ,@DTT_WPEWartoscWal
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty brutto w walucie obcej. ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 15 - PPK Składka podstawowa pracownika
        IF ROUND(@DTT_PPKPrcPodst,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,15
                        ,@DTT_PPKPrcPodst
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK - Składka podstawowa pracownika ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 16 - PPK Składka dodatkowa pracownika
        IF ROUND(@DTT_PPKPrcDod,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,16
                        ,@DTT_PPKPrcDod
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK - Składka dodatkowa pracownika ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 17 - PPK Składka podstawowa pracodawcy
        IF ROUND(@DTT_PPKFirPodst,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,17
                        ,@DTT_PPKFirPodst
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK Składka podstawowa pracodawcy ', 16, 1)
                        --RETURN 215
                END
        END

		--nowa wartosc pola  DWK_Kategoria = 18 - PPK Składka dodatkowa pracodawcy
        IF ROUND(@DTT_PPKFirDod,2) &lt;&gt; 0
        BEGIN
                SET @czyBylaKwota = @czyBylaKwota + 1
                SET @MaxDwkID = @MaxDwkID + 1
                INSERT INTO  [CDN].[DtsWyplatyKwoty]
                        ([DWK_ID]
                        ,[DWK_DwpID]
                        ,[DWK_Rodzaj]
                        ,[DWK_Kategoria]
                        ,[DWK_Kwota]
                        ,[DWK_RodzajFIS]
                        ,[DWK_KosztFirma]
                        ,[DWK_UBZTyuId])
                  VALUES
                        (@MaxDwkID
                        ,@MaxDwpID
                        ,@DTT_Rodzaj
                        ,18
                        ,@DTT_PPKFirDod
                        ,@DTT_RodzajFIS
                        ,@DTT_KosztFirma
                        ,@DTT_UBZTyuId)
                IF @@ERROR &lt;&gt; 0
                BEGIN
                        --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED
                        RAISERROR('215:Błąd dodawania rekordu do DtsWyplatyKwoty dla kwoty PPK Składka dodatkowa pracodawcy ', 16, 1)
                        --RETURN 215
                END
        END




	END
	CLOSE CursorForDWP
    DEALLOCATE CursorForDWP


END

</FONT>
        </PRE>
      </P>
      <HR>
    </DIV>
</BODY>
</HTML>